{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-_,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\ud83c\udf10 UBI - Universal Base Image","text":""},{"location":"#the-foundational-developer-platform-for-all-ego-hygiene-projects","title":"The foundational developer platform for all Ego Hygiene projects","text":"<p>Your all-in-one dev environment: reproducible builds, universal tooling, and cohesive DX. \ud83d\udee0\ufe0f\u2728</p>"},{"location":"#what-is-ubi","title":"\ud83d\udcd8 What is UBI?","text":"<p>UBI (Universal Base Image) is the baseline container environment for all Ego Hygiene projects. It provides a reproducible, stable, and developer-experience-optimized foundation that every devcontainer and project in the organization builds upon.</p> <p>Instead of each project maintaining its own environment setup, UBI serves as the single source of truth \u2014 ensuring:</p> <ul> <li>Consistency: Every developer works in an identical environment</li> <li>Reproducibility: Builds are deterministic and versioned</li> <li>Developer Happiness: Pre-configured with sensible defaults and modern tooling</li> <li>Maintainability: Update the base once, benefit everywhere</li> </ul> <p>UBI is distributed via GitHub Container Registry (GHCR) and consumed by other repositories as their base image.</p>"},{"location":"#features","title":"\u2728 Features","text":""},{"location":"#fully-xdg-aligned-filesystem","title":"\ud83d\uddc2\ufe0f Fully XDG-Aligned Filesystem","text":"<p>Adheres to the XDG Base Directory Specification for predictable configuration and data locations.</p>"},{"location":"#optuniversal-hierarchy","title":"\ud83d\udcc1 <code>/opt/universal/*</code> Hierarchy","text":"<p>Standardized paths for binaries, configs, caches, logs, and more:</p> <ul> <li><code>/opt/universal/bin</code> - Universal binaries</li> <li><code>/opt/universal/config</code> - Configuration files (XDG_CONFIG_HOME)</li> <li><code>/opt/universal/cache</code> - Cache directory (XDG_CACHE_HOME)</li> <li><code>/opt/universal/toolbox</code> - Data files (XDG_DATA_HOME)</li> <li><code>/opt/universal/runtime</code> - Runtime state (XDG_STATE_HOME)</li> <li><code>/opt/universal/logs</code> - Centralized logs</li> <li><code>/opt/universal/apps</code> - Application resources</li> </ul>"},{"location":"#predictable-runtime-environment","title":"\u2699\ufe0f Predictable Runtime Environment","text":"<p>Pre-configured environment variables for consistent behavior across all projects and CI/CD pipelines.</p>"},{"location":"#security-first","title":"\ud83d\udd12 Security First","text":"<ul> <li>Pinned base images with digest verification</li> <li>Automated vulnerability scanning with Trivy</li> <li>SBOM generation for supply chain transparency</li> <li>Regular security updates</li> </ul>"},{"location":"#developer-experience","title":"\ud83d\ude80 Developer Experience","text":"<ul> <li>Modern terminal configuration</li> <li>Sensible defaults</li> <li>Telemetry disabled by default</li> <li>Comprehensive documentation</li> </ul>"},{"location":"#quick-start","title":"\ud83d\ude80 Quick Start","text":""},{"location":"#using-in-your-devcontainer","title":"Using in Your Devcontainer","text":"<p>Reference UBI in your <code>.devcontainer/devcontainer.json</code>:</p> <pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\",\n  \"features\": {\n    // Add your project-specific features\n  }\n}\n</code></pre>"},{"location":"#using-as-a-base-image","title":"Using as a Base Image","text":"<p>Reference UBI in your <code>Dockerfile</code>:</p> <pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5\n\n# Add your project-specific layers\n</code></pre>"},{"location":"#version-pinning","title":"Version Pinning","text":"<p>For maximum reproducibility, pin to a specific version:</p> <pre><code># Pin to specific version\nFROM ghcr.io/egohygiene/ubi:0.1.5\n\n# Or pin to exact commit SHA\nFROM ghcr.io/egohygiene/ubi:sha-abc123\n</code></pre>"},{"location":"#documentation","title":"\ud83d\udcda Documentation","text":""},{"location":"#core-documentation","title":"Core Documentation","text":"<ul> <li>Architecture - Design principles and implementation details</li> <li>Troubleshooting - Solutions to common issues</li> <li>Release Process - Version management and publishing workflow</li> <li>Security Overview - Security practices and policies</li> </ul>"},{"location":"#getting-started","title":"Getting Started","text":"<ul> <li>Installation - How to install and use UBI</li> <li>Quick Start - Get up and running quickly</li> </ul>"},{"location":"#examples","title":"Examples","text":"<ul> <li>Examples - Practical examples and use cases</li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<ul> <li>Contributing Guide - How to contribute to UBI</li> <li>Best Practices - Recommendations for using UBI</li> </ul>"},{"location":"#version-release","title":"\ud83c\udff7 Version &amp; Release","text":"<p>Current Version: 0.1.5</p> <p>UBI follows Semantic Versioning:</p> <ul> <li>MAJOR: Breaking changes to environment or filesystem structure</li> <li>MINOR: New features, tools, or non-breaking enhancements</li> <li>PATCH: Bug fixes and minor updates</li> </ul> <p>See the Changelog for detailed release history.</p>"},{"location":"#contributing_1","title":"\ud83e\udd1d Contributing","text":"<p>We welcome contributions! Please see our Contributing Guide for details.</p>"},{"location":"#quick-links","title":"Quick Links","text":"<ul> <li>GitHub Repository</li> <li>Issues</li> <li>Discussions</li> <li>Container Registry</li> </ul>"},{"location":"#license","title":"\ud83d\udcc4 License","text":"<p>This project is licensed under the MIT License - see the License file for details.</p>"},{"location":"#additional-resources","title":"\ud83d\udd17 Additional Resources","text":"<ul> <li>Main README</li> <li>Security Policy</li> <li>DevContainer Configuration</li> <li>GitHub Actions Workflows</li> </ul> <p>Last Updated: 2025-12-13 Documentation Version: 0.1.5</p>"},{"location":"CHANGELOG_PATTERN_FIX/","title":"CHANGELOG Regex Pattern Fix","text":""},{"location":"CHANGELOG_PATTERN_FIX/#problem-summary","title":"Problem Summary","text":"<p>The original <code>bump-my-version</code> CHANGELOG rule used a regex pattern that caused duplicate version insertions and corrupted the CHANGELOG structure during automated version bumps.</p>"},{"location":"CHANGELOG_PATTERN_FIX/#root-cause-analysis","title":"Root Cause Analysis","text":""},{"location":"CHANGELOG_PATTERN_FIX/#the-problem-patterns","title":"The Problem Patterns","text":"<ol> <li>Pattern: <code>\\A##</code> (Start of string)</li> <li>Issue: CHANGELOG.md starts with <code># Changelog\\n\\n</code>, not <code>##</code></li> <li>Result: Matches 0 times - pattern is ineffective</li> <li> <p>Impact: No CHANGELOG updates occur</p> </li> <li> <p>Pattern: <code>^##</code> (Start of line with MULTILINE)</p> </li> <li>Issue: Matches every version header in the file</li> <li>Result: Matches 6+ times for all version sections</li> <li>Impact: Creates duplicate entries on each bump</li> </ol>"},{"location":"CHANGELOG_PATTERN_FIX/#changelog-structure","title":"CHANGELOG Structure","text":"<pre><code># Changelog\n\n## 0.1.5 (2025-12-11)\n[Compare the full difference.](...)\n\n### Changed\n- Some changes\n\n## 0.1.4 (2025-12-11)\n[Compare the full difference.](...)\n</code></pre>"},{"location":"CHANGELOG_PATTERN_FIX/#solution","title":"Solution","text":""},{"location":"CHANGELOG_PATTERN_FIX/#correct-pattern-changelognn","title":"Correct Pattern: <code>(# Changelog\\n\\n)##</code>","text":"<p>This pattern:</p> <ul> <li>Matches the literal string <code># Changelog\\n\\n##</code></li> <li>Captures <code># Changelog\\n\\n</code> as group 1</li> <li>Targets only the first occurrence after the header</li> <li>Works regardless of how many version sections exist</li> </ul>"},{"location":"CHANGELOG_PATTERN_FIX/#configuration","title":"Configuration","text":"<pre><code>[[tool.bumpversion.files]]\nfilename = \"CHANGELOG.md\"\nregex = true\nsearch = \"(# Changelog\\\\n\\\\n)## \"\nreplace = \"\\\\g&lt;1&gt;## {new_version} ({now:%Y-%m-%d})\\n[Compare the full difference.](https://github.com/egohygiene/ubi/compare/{current_version}...{new_version})\\n\\n## \"\n</code></pre>"},{"location":"CHANGELOG_PATTERN_FIX/#how-it-works","title":"How It Works","text":"<ol> <li>Search: Finds <code># Changelog\\n\\n##</code> at the start</li> <li>Capture: Group 1 = <code># Changelog\\n\\n</code></li> <li>Replace: Reconstructs with: <code>&lt;captured header&gt;</code> + <code>&lt;new version&gt;</code> + <code>##</code></li> <li>Result: New version inserted between header and first existing version</li> </ol>"},{"location":"CHANGELOG_PATTERN_FIX/#validation","title":"Validation","text":""},{"location":"CHANGELOG_PATTERN_FIX/#test-results","title":"Test Results","text":"<p>\u2705 Single bump: Adds exactly 1 new section \u2705 Multiple bumps: No duplication across sequential versions \u2705 Structure: Preserves CHANGELOG format \u2705 Position: New version appears at top (after header)</p>"},{"location":"CHANGELOG_PATTERN_FIX/#dry-run-output","title":"Dry-Run Output","text":"<pre><code>$ bump-my-version bump patch --dry-run\n\nFile CHANGELOG.md: replace `(# Changelog\\n\\n)## ` with ...\n  Found '(# Changelog\\n\\n)## ' at line 1: # Changelog\n\n##\n  Would change file CHANGELOG.md:\n    *** before CHANGELOG.md\n    --- after CHANGELOG.md\n    ***************\n    *** 1,4 ****\n    --- 1,7 ----\n      # Changelog\n    +\n    + ## 0.1.6 (2025-12-13)\n    + [Compare the full difference.](https://github.com/egohygiene/ubi/compare/0.1.5...0.1.6)\n\n      ## 0.1.5 (2025-12-11)\n      [Compare the full difference.](https://github.com/egohygiene/ubi/compare/0.1.4...0.1.5)\n</code></pre>"},{"location":"CHANGELOG_PATTERN_FIX/#verification-steps","title":"Verification Steps","text":"<p>To verify the fix works correctly:</p> <pre><code># 1. Dry-run bump to see what would change\nbump-my-version bump patch --dry-run --verbose\n\n# 2. Check that only ONE occurrence is matched\n# Look for: \"Found '(# Changelog\\n\\n)## ' at line 1\"\n\n# 3. Verify the diff shows exactly one new section\n# The diff should show: +3 lines (header + link + blank)\n\n# 4. Confirm no duplication in subsequent bumps\n# Run multiple dry-runs and verify each adds only 1 section\n</code></pre>"},{"location":"CHANGELOG_PATTERN_FIX/#technical-details","title":"Technical Details","text":""},{"location":"CHANGELOG_PATTERN_FIX/#regex-anchors-comparison","title":"Regex Anchors Comparison","text":"Anchor Meaning Effect on CHANGELOG <code>\\A</code> Start of string Doesn't match (file starts with <code># Changelog</code>) <code>^</code> Start of line Matches ALL version headers (with MULTILINE) <code>(# Changelog\\n\\n)</code> Literal match Matches only the header + first version"},{"location":"CHANGELOG_PATTERN_FIX/#capture-groups","title":"Capture Groups","text":"<ul> <li>Group 0: Full match <code># Changelog\\n\\n##</code></li> <li>Group 1: Captured <code># Changelog\\n\\n</code></li> <li><code>\\g&lt;1&gt;</code>: Backreference to restore the captured header</li> </ul>"},{"location":"CHANGELOG_PATTERN_FIX/#related-issues","title":"Related Issues","text":"<ul> <li>Issue: TASK-015 \u2014 Fix CHANGELOG Regex Pattern for bump-my-version</li> <li>Priority: P2</li> <li>Labels: bug, versioning, audit-followup</li> </ul>"},{"location":"CHANGELOG_PATTERN_FIX/#references","title":"References","text":"<ul> <li>bump-my-version documentation</li> <li>Python regex documentation</li> <li>Keep a Changelog format</li> </ul>"},{"location":"CHANGELOG_PATTERN_FIX/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li> pyproject.toml uses corrected search regex</li> <li> Dry-run bump produces one correct new entry</li> <li> No duplicate version blocks appear in CHANGELOG</li> <li> Subsequent automated bumps behave consistently</li> </ul>"},{"location":"MKDOCS_SETUP/","title":"MkDocs Setup and Configuration","text":"<p>This document provides instructions for maintaining and configuring the MkDocs documentation site for UBI.</p>"},{"location":"MKDOCS_SETUP/#overview","title":"Overview","text":"<p>The UBI documentation site is built using:</p> <ul> <li>MkDocs - Static site generator for project documentation</li> <li>Material for MkDocs - Modern, feature-rich theme</li> <li>GitHub Pages - Hosting platform for the documentation site</li> <li>GitHub Actions - Automated deployment pipeline</li> </ul> <p>Live site: https://egohygiene.github.io/ubi/</p>"},{"location":"MKDOCS_SETUP/#local-development","title":"Local Development","text":""},{"location":"MKDOCS_SETUP/#prerequisites","title":"Prerequisites","text":"<pre><code># Install dependencies\npip install mkdocs mkdocs-material\n</code></pre>"},{"location":"MKDOCS_SETUP/#commands","title":"Commands","text":"<pre><code># Serve documentation locally with live reload\nmkdocs serve\n\n# Build static site\nmkdocs build\n\n# Deploy to GitHub Pages (manual)\nmkdocs gh-deploy\n</code></pre>"},{"location":"MKDOCS_SETUP/#file-structure","title":"File Structure","text":"<pre><code>.\n\u251c\u2500\u2500 mkdocs.yml              # MkDocs configuration\n\u251c\u2500\u2500 docs/                   # Documentation source files\n\u2502   \u251c\u2500\u2500 index.md           # Home page\n\u2502   \u251c\u2500\u2500 architecture.md    # Architecture documentation\n\u2502   \u251c\u2500\u2500 examples.md        # Examples and use cases\n\u2502   \u251c\u2500\u2500 getting-started/   # Getting started guides\n\u2502   \u251c\u2500\u2500 security/          # Security documentation\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 site/                   # Built documentation (gitignored)\n</code></pre>"},{"location":"MKDOCS_SETUP/#github-pages-configuration","title":"GitHub Pages Configuration","text":""},{"location":"MKDOCS_SETUP/#enable-github-pages","title":"Enable GitHub Pages","text":"<ol> <li>Go to repository Settings \u2192 Pages</li> <li>Under Source, select:</li> <li>Branch: <code>gh-pages</code></li> <li>Folder: <code>/ (root)</code></li> <li>Click Save</li> </ol> <p>The site will be available at: <code>https://egohygiene.github.io/ubi/</code></p>"},{"location":"MKDOCS_SETUP/#automated-deployment","title":"Automated Deployment","text":"<p>Documentation is automatically deployed when:</p> <ul> <li>Changes are pushed to <code>main</code> branch</li> <li>Changes affect:</li> <li><code>docs/**</code></li> <li><code>mkdocs.yml</code></li> <li><code>.github/workflows/docs.yml</code></li> <li><code>pyproject.toml</code></li> </ul> <p>Workflow file: <code>.github/workflows/docs.yml</code></p>"},{"location":"MKDOCS_SETUP/#manual-deployment","title":"Manual Deployment","text":"<p>To deploy manually:</p> <pre><code># From local machine\nmkdocs gh-deploy\n</code></pre> <p>Or trigger the workflow:</p> <ol> <li>Go to Actions \u2192 \ud83d\udcda Build &amp; Deploy Documentation</li> <li>Click Run workflow</li> <li>Select branch and run</li> </ol>"},{"location":"MKDOCS_SETUP/#configuration","title":"Configuration","text":""},{"location":"MKDOCS_SETUP/#mkdocsyml","title":"mkdocs.yml","text":"<p>Main configuration file for MkDocs:</p> <pre><code>site_name: UBI Documentation\nsite_url: https://egohygiene.github.io/ubi/\nrepo_name: egohygiene/ubi\nrepo_url: https://github.com/egohygiene/ubi\n\ntheme:\n  name: material\n  palette:\n    # Light/dark mode toggle\n  features:\n    # Navigation, search, and UI features\n\nplugins:\n  - search\n\nmarkdown_extensions:\n  # Enhanced markdown features\n\nnav:\n  # Navigation structure\n</code></pre>"},{"location":"MKDOCS_SETUP/#key-configuration-sections","title":"Key Configuration Sections","text":"<p>Theme features: - Navigation tabs and sections - Search with highlighting - Light/dark mode toggle - Edit page links - Mobile-responsive design</p> <p>Markdown extensions: - Code blocks with syntax highlighting - Admonitions (notes, warnings, tips) - Task lists - Tables - Emoji support - Mermaid diagrams</p> <p>Navigation: - Manually defined in <code>mkdocs.yml</code> - Organized by category - Links to all main documentation pages</p>"},{"location":"MKDOCS_SETUP/#writing-documentation","title":"Writing Documentation","text":""},{"location":"MKDOCS_SETUP/#markdown-syntax","title":"Markdown Syntax","text":"<p>MkDocs uses standard Markdown with extensions:</p> <p>Admonitions:</p> <pre><code>!!! note\n    This is a note admonition.\n\n!!! warning\n    This is a warning admonition.\n\n!!! tip\n    This is a tip admonition.\n</code></pre> <p>Code blocks:</p> <pre><code>\\`\\`\\`python title=\"example.py\"\ndef hello_world():\n    print(\"Hello, World!\")\n\\`\\`\\`\n</code></pre> <p>Tabs:</p> <pre><code>=== \"Tab 1\"\n    Content for tab 1\n\n=== \"Tab 2\"\n    Content for tab 2\n</code></pre>"},{"location":"MKDOCS_SETUP/#best-practices","title":"Best Practices","text":"<ol> <li> <p>Test locally before pushing:    <pre><code>mkdocs serve\n</code></pre></p> </li> <li> <p>Use relative links for internal docs:    <pre><code>[Architecture](architecture.md)\n[Examples](examples.md)\n</code></pre></p> </li> <li> <p>Add new pages to navigation in <code>mkdocs.yml</code>:    <pre><code>nav:\n  - Home: index.md\n  - New Page: new-page.md\n</code></pre></p> </li> <li> <p>Use descriptive titles in frontmatter:    <pre><code># Page Title\n\nBrief introduction...\n</code></pre></p> </li> <li> <p>Include code examples where appropriate</p> </li> <li> <p>Keep pages focused - one topic per page</p> </li> </ol>"},{"location":"MKDOCS_SETUP/#troubleshooting","title":"Troubleshooting","text":""},{"location":"MKDOCS_SETUP/#build-failures","title":"Build Failures","text":"<p>Issue: <code>mkdocs build</code> fails</p> <p>Solution: - Check <code>mkdocs.yml</code> syntax - Verify all files referenced in <code>nav</code> exist - Check for broken internal links - Review error messages for specific issues</p>"},{"location":"MKDOCS_SETUP/#github-pages-not-updating","title":"GitHub Pages Not Updating","text":"<p>Issue: Changes not appearing on live site</p> <p>Solution: 1. Check GitHub Actions workflow status 2. Verify <code>gh-pages</code> branch was updated 3. Clear browser cache 4. Check GitHub Pages settings 5. Review workflow logs for errors</p>"},{"location":"MKDOCS_SETUP/#local-build-works-ci-fails","title":"Local Build Works, CI Fails","text":"<p>Issue: Build succeeds locally but fails in CI</p> <p>Solution: - Ensure dependencies are in <code>pyproject.toml</code> - Check Python version compatibility - Review CI workflow logs - Test with same Python version as CI</p>"},{"location":"MKDOCS_SETUP/#links-not-working","title":"Links Not Working","text":"<p>Issue: Internal links broken on live site</p> <p>Solution: - Use relative links: <code>[Page](page.md)</code> not <code>[Page](/page.md)</code> - Ensure linked files exist in <code>docs/</code> - Check <code>nav</code> configuration in <code>mkdocs.yml</code> - Test with <code>mkdocs serve</code> locally</p>"},{"location":"MKDOCS_SETUP/#maintenance","title":"Maintenance","text":""},{"location":"MKDOCS_SETUP/#updating-dependencies","title":"Updating Dependencies","text":"<p>Check for updates:</p> <pre><code>pip list --outdated | grep mkdocs\n</code></pre> <p>Update dependencies:</p> <pre><code># Update MkDocs\npip install --upgrade mkdocs mkdocs-material\n\n# Update pyproject.toml if needed\n</code></pre> <p>Test after updates:</p> <pre><code>mkdocs build\nmkdocs serve\n</code></pre>"},{"location":"MKDOCS_SETUP/#adding-new-pages","title":"Adding New Pages","text":"<ol> <li>Create new <code>.md</code> file in <code>docs/</code></li> <li>Add to <code>nav</code> in <code>mkdocs.yml</code></li> <li>Test locally</li> <li>Commit and push</li> </ol>"},{"location":"MKDOCS_SETUP/#changing-theme","title":"Changing Theme","text":"<p>To customize the Material theme:</p> <p>Colors:</p> <pre><code>theme:\n  palette:\n    primary: indigo\n    accent: indigo\n</code></pre> <p>Features:</p> <pre><code>theme:\n  features:\n    - navigation.tabs\n    - navigation.sections\n    - search.highlight\n</code></pre> <p>See Material for MkDocs documentation for more options.</p>"},{"location":"MKDOCS_SETUP/#resources","title":"Resources","text":"<ul> <li>MkDocs: https://www.mkdocs.org/</li> <li>Material for MkDocs: https://squidfunk.github.io/mkdocs-material/</li> <li>GitHub Pages: https://pages.github.com/</li> <li>Markdown Guide: https://www.markdownguide.org/</li> </ul>"},{"location":"MKDOCS_SETUP/#getting-help","title":"Getting Help","text":"<p>If you encounter issues with the documentation site:</p> <ol> <li>Check this guide</li> <li>Review MkDocs documentation</li> <li>Check Material theme docs</li> <li>Open an issue on GitHub</li> <li>Ask in discussions</li> </ol> <p>Last Updated: 2025-12-13</p>"},{"location":"architecture/","title":"UBI Architecture","text":""},{"location":"architecture/#overview","title":"Overview","text":"<p>UBI (Universal Base Image) serves as the foundational development container for all Ego Hygiene projects. It provides a consistent, reproducible, and developer-experience-optimized platform that eliminates environment drift and configuration overhead.</p>"},{"location":"architecture/#core-goals","title":"Core Goals","text":""},{"location":"architecture/#1-consistency-across-projects","title":"1. Consistency Across Projects","text":"<p>Every developer and CI environment works with an identical baseline, ensuring:</p> <ul> <li>Predictable behavior across local development and CI/CD</li> <li>Reduced \"works on my machine\" issues</li> <li>Standardized tooling and configuration</li> </ul>"},{"location":"architecture/#2-reproducibility","title":"2. Reproducibility","text":"<p>All builds are deterministic and auditable through:</p> <ul> <li>Semantic versioning (SemVer)</li> <li>Pinned base image with digest verification</li> <li>Version-tagged releases published to GHCR</li> <li>Immutable container images</li> </ul>"},{"location":"architecture/#3-developer-experience-dx","title":"3. Developer Experience (DX)","text":"<p>Sensible defaults reduce friction:</p> <ul> <li>Pre-configured environment variables</li> <li>Standardized filesystem layout</li> <li>XDG-compliant directory structure</li> <li>Telemetry disabled by default</li> <li>Modern terminal and editor support</li> </ul>"},{"location":"architecture/#4-maintainability","title":"4. Maintainability","text":"<p>Single source of truth for environment configuration:</p> <ul> <li>Update once, benefit everywhere</li> <li>Clear versioning and changelog</li> <li>Automated release pipeline</li> <li>Security scanning and SBOM generation</li> </ul>"},{"location":"architecture/#xdg-base-directory-strategy","title":"XDG Base Directory Strategy","text":"<p>UBI follows the XDG Base Directory Specification to provide predictable locations for configuration, cache, and application data.</p>"},{"location":"architecture/#standard-xdg-variables","title":"Standard XDG Variables","text":"<pre><code>XDG_CONFIG_HOME=/opt/universal/config   # Application configuration\nXDG_CACHE_HOME=/opt/universal/cache     # Application caches\nXDG_DATA_HOME=/opt/universal/toolbox    # Application data\nXDG_STATE_HOME=/opt/universal/runtime   # Application state\n</code></pre>"},{"location":"architecture/#benefits","title":"Benefits","text":"<ul> <li>Predictability: Applications know where to store data</li> <li>Cleanliness: No scattered dotfiles in home directory</li> <li>Isolation: Clear separation between config, cache, and data</li> <li>Compliance: Industry-standard approach adopted by modern tools</li> </ul>"},{"location":"architecture/#universal-filesystem-layout","title":"Universal Filesystem Layout","text":"<p>The <code>/opt/universal</code> hierarchy provides a centralized, organized structure for all development resources.</p>"},{"location":"architecture/#directory-structure","title":"Directory Structure","text":"<pre><code>/opt/universal/\n\u251c\u2500\u2500 bin/           # Universal binaries and executables\n\u251c\u2500\u2500 config/        # Configuration files (XDG_CONFIG_HOME)\n\u251c\u2500\u2500 cache/         # Cache directory (XDG_CACHE_HOME)\n\u2502   \u2514\u2500\u2500 apt/       # APT package cache\n\u251c\u2500\u2500 toolbox/       # Data files (XDG_DATA_HOME)\n\u251c\u2500\u2500 runtime/       # Runtime state (XDG_STATE_HOME)\n\u251c\u2500\u2500 logs/          # Centralized application logs\n\u251c\u2500\u2500 apps/          # Application resources (XDG_DATA_DIRS)\n\u251c\u2500\u2500 reports/       # Generated reports and artifacts\n\u251c\u2500\u2500 lib/           # Shared libraries\n\u251c\u2500\u2500 locks/         # Lock files for resource coordination\n\u2514\u2500\u2500 fonts/         # Custom fonts\n</code></pre>"},{"location":"architecture/#environment-variables","title":"Environment Variables","text":"<p>All paths are exposed as environment variables for easy reference:</p> <pre><code>UNIVERSAL_HOME=/opt/universal\nUNIVERSAL_BIN=/opt/universal/bin\nUNIVERSAL_CONFIG=/opt/universal/config\nUNIVERSAL_CACHE=/opt/universal/cache\nUNIVERSAL_TOOLBOX=/opt/universal/toolbox\nUNIVERSAL_RUNTIME=/opt/universal/runtime\nUNIVERSAL_LOGS=/opt/universal/logs\nUNIVERSAL_APPS=/opt/universal/apps\nUNIVERSAL_REPORTS=/opt/universal/reports\nUNIVERSAL_LIB=/opt/universal/lib\nUNIVERSAL_LOCKS=/opt/universal/locks\nUNIVERSAL_FONTS=/opt/universal/fonts\n</code></pre>"},{"location":"architecture/#devcontainer-architecture","title":"Devcontainer Architecture","text":"<p>UBI is designed to be consumed as a base image for VS Code devcontainers.</p>"},{"location":"architecture/#usage-pattern","title":"Usage Pattern","text":"<p>Projects inherit from UBI and extend as needed:</p> <pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:0.1.5\",\n  \"features\": {\n    // Project-specific devcontainer features\n  },\n  \"customizations\": {\n    \"vscode\": {\n      // VS Code settings\n    }\n  }\n}\n</code></pre>"},{"location":"architecture/#key-features","title":"Key Features","text":"<ul> <li>Base Image: <code>mcr.microsoft.com/devcontainers/base:2.1.2</code> (pinned with digest)</li> <li>User: <code>vscode</code> (non-root by default)</li> <li>Shell: Bash with safer defaults (errexit, pipefail, nounset)</li> <li>Security: No privileged mode required (see security documentation)</li> </ul>"},{"location":"architecture/#cicd-architecture","title":"CI/CD Architecture","text":""},{"location":"architecture/#build-pipeline","title":"Build Pipeline","text":"<p>UBI uses a fully automated CI/CD pipeline powered by GitHub Actions.</p> <pre><code>graph LR\n    A[Version Bump] --&gt; B[Git Tag]\n    B --&gt; C[Trigger Publish]\n    C --&gt; D[Build Image]\n    D --&gt; E[Security Scan]\n    E --&gt; F[Generate SBOM]\n    F --&gt; G[Push to GHCR]</code></pre>"},{"location":"architecture/#workflows","title":"Workflows","text":"<ol> <li><code>bump-version.yml</code>: Manual trigger to bump SemVer version</li> <li>Uses <code>bump-my-version</code> tool</li> <li>Updates VERSION, CHANGELOG.md, and pyproject.toml</li> <li> <p>Creates git commit and tag</p> </li> <li> <p><code>publish.yml</code>: Automated image build and publish</p> </li> <li>Triggered on push to main or tag creation</li> <li>Multi-platform builds (amd64, arm64)</li> <li>Publishes to GHCR with multiple tags</li> <li> <p>Generates SBOM with Syft</p> </li> <li> <p><code>trivy-scan.yml</code>: Container vulnerability scanning</p> </li> <li>Runs on PRs, pushes, and weekly schedule</li> <li>Scans for CVEs in base image and dependencies</li> <li> <p>Uploads results to GitHub Security tab</p> </li> <li> <p><code>test-unified.yml</code>: Unified container testing</p> </li> <li>Comprehensive Goss validation for base variant</li> <li>Multi-variant testing (base, minimal, python, node, full)</li> <li>Validates environment variables and directory structure</li> <li>Tests permissions, locale, and fundamental tools</li> <li>Structured test reports with JSON output</li> </ol>"},{"location":"architecture/#multi-stage-build-process","title":"Multi-Stage Build Process","text":"<p>The Dockerfile uses a three-stage build for clarity and organization.</p>"},{"location":"architecture/#stage-1-base","title":"Stage 1: Base","text":"<pre><code>FROM mcr.microsoft.com/devcontainers/base:2.1.2@sha256:... AS base\n</code></pre> <ul> <li>Establishes the foundation from Microsoft's devcontainer base</li> <li>Sets safer shell defaults</li> <li>Pinned with digest for reproducibility</li> </ul>"},{"location":"architecture/#stage-2-environment","title":"Stage 2: Environment","text":"<pre><code>FROM base AS environment\n</code></pre> <ul> <li>Defines all build arguments (ARGs)</li> <li>Sets environment variables (ENVs)</li> <li>Configures XDG directories</li> <li>Establishes the <code>/opt/universal</code> structure</li> </ul>"},{"location":"architecture/#stage-3-final","title":"Stage 3: Final","text":"<pre><code>FROM environment AS final\n</code></pre> <ul> <li>Creates universal directories with proper permissions</li> <li>Sets up the vscode user</li> <li>Configures PATH and shell environment</li> <li>Final image ready for consumption</li> </ul>"},{"location":"architecture/#build-arguments","title":"Build Arguments","text":"<p>UBI supports customization via build arguments:</p> <pre><code>docker build \\\n  --build-arg LANG=en_US.UTF-8 \\\n  --build-arg TZ=America/New_York \\\n  --build-arg EDITOR=vim \\\n  -f .devcontainer/Dockerfile \\\n  -t ubi:custom .\n</code></pre>"},{"location":"architecture/#versioning-strategy","title":"Versioning Strategy","text":""},{"location":"architecture/#semantic-versioning-semver","title":"Semantic Versioning (SemVer)","text":"<p>UBI follows strict SemVer: <code>MAJOR.MINOR.PATCH</code></p> <ul> <li>MAJOR: Breaking changes to environment or filesystem structure</li> <li>MINOR: New features, tools, or non-breaking enhancements</li> <li>PATCH: Bug fixes and minor updates</li> </ul>"},{"location":"architecture/#version-sources","title":"Version Sources","text":"<ul> <li><code>VERSION</code> file: Single source of truth (e.g., <code>0.1.5</code>)</li> <li><code>pyproject.toml</code>: Python tooling compatibility</li> <li>CHANGELOG.md: Automatically updated on version bump</li> <li>Git tags: Created automatically by bump workflow</li> </ul>"},{"location":"architecture/#image-tags","title":"Image Tags","text":"<p>Every release publishes multiple tags to GHCR:</p> <pre><code>ghcr.io/egohygiene/ubi:latest          # Always points to latest stable\nghcr.io/egohygiene/ubi:0.1.5           # Specific version (pinned)\nghcr.io/egohygiene/ubi:sha-abc123      # Git commit SHA (reproducibility)\n</code></pre> <p>Recommendation: Use specific version tags (e.g., <code>0.1.5</code>) in production environments.</p>"},{"location":"architecture/#security-architecture","title":"Security Architecture","text":"<p>UBI implements multiple layers of security:</p> <ol> <li>Base Image Pinning: Digest-pinned base image prevents supply chain attacks</li> <li>No Privileged Mode: Container runs with standard isolation (see privileged-mode.md)</li> <li>Vulnerability Scanning: Automated Trivy scans on every build</li> <li>SBOM Generation: Software Bill of Materials for transparency</li> <li>Non-Root User: Runs as <code>vscode</code> user by default</li> </ol> <p>For detailed security information, see security-overview.md.</p>"},{"location":"architecture/#environment-configuration","title":"Environment Configuration","text":""},{"location":"architecture/#locale-and-system","title":"Locale and System","text":"<pre><code>LANG=en_US.UTF-8\nLC_ALL=en_US.UTF-8\nTZ=UTC\nTERM=xterm-256color\n</code></pre>"},{"location":"architecture/#development-tools","title":"Development Tools","text":"<pre><code>EDITOR=code              # VS Code as default editor\nVISUAL=code\nPAGER=less\nGIT_PAGER=less\n</code></pre>"},{"location":"architecture/#language-specific","title":"Language-Specific","text":"<p>Python:</p> <pre><code>PYTHONUNBUFFERED=1\nPYTHONIOENCODING=UTF-8\nPYTHONUTF8=1\nPIP_NO_CACHE_DIR=1\n</code></pre> <p>Node.js:</p> <pre><code>NODE_OPTIONS=--max-old-space-size=4096\n</code></pre> <p>Rust:</p> <pre><code>CARGO_TERM_COLOR=always\n</code></pre>"},{"location":"architecture/#privacy","title":"Privacy","text":"<p>All telemetry is disabled by default:</p> <pre><code>DO_NOT_TRACK=1\nTELEMETRY_ENABLED=0\nNEXT_TELEMETRY_DISABLED=1\nDOTNET_CLI_TELEMETRY_OPTOUT=1\n</code></pre>"},{"location":"architecture/#design-decisions","title":"Design Decisions","text":""},{"location":"architecture/#why-optuniversal","title":"Why <code>/opt/universal</code>?","text":"<ul> <li>FHS Compliant: <code>/opt</code> is designated for add-on software packages</li> <li>Centralized: Single hierarchy for all resources</li> <li>Predictable: Clear structure easy to navigate and understand</li> <li>Non-Intrusive: Doesn't conflict with system directories</li> </ul>"},{"location":"architecture/#why-pin-base-image-with-digest","title":"Why Pin Base Image with Digest?","text":"<ul> <li>Reproducibility: Same digest always pulls identical image</li> <li>Security: Prevents tag hijacking and supply chain attacks</li> <li>Auditability: Exact image version is traceable</li> <li>Stability: Protects against unexpected upstream changes</li> </ul>"},{"location":"architecture/#why-semantic-versioning","title":"Why Semantic Versioning?","text":"<ul> <li>Clarity: Clear communication of change impact</li> <li>Automation: Tools can parse and compare versions</li> <li>Standard: Industry-wide convention</li> <li>Predictability: Consumers know what to expect</li> </ul>"},{"location":"architecture/#future-considerations","title":"Future Considerations","text":""},{"location":"architecture/#planned-enhancements","title":"Planned Enhancements","text":"<ul> <li>Cosign Image Signing: Cryptographic verification of images</li> <li>Multi-Language Runtime Support: Optional language runtimes via features</li> <li>Performance Optimizations: Layer caching improvements</li> <li>Documentation Site: MkDocs-powered documentation portal</li> </ul>"},{"location":"architecture/#extensibility","title":"Extensibility","text":"<p>UBI is designed to be extended, not modified:</p> <ul> <li>Projects layer on top via Dockerfile or devcontainer features</li> <li>Base remains stable and minimal</li> <li>Extensions don't affect UBI's core functionality</li> </ul>"},{"location":"architecture/#references","title":"References","text":"<ul> <li>XDG Base Directory Specification</li> <li>Filesystem Hierarchy Standard (FHS)</li> <li>Semantic Versioning 2.0.0</li> <li>DevContainers Specification</li> <li>Microsoft DevContainers Base Image</li> </ul>"},{"location":"changelog/","title":"Changelog","text":"<p>Canonical Source</p> <p>This page references the canonical changelog maintained in the repository root.</p> <p>\ud83d\udcc4 View the full CHANGELOG.md \u2192</p> <p>All notable changes to the UBI (Universal Base Image) project are documented in the root <code>CHANGELOG.md</code> file, which is automatically updated by the version bump process.</p>"},{"location":"changelog/#about-versioning","title":"About Versioning","text":"<p>This project adheres to Semantic Versioning:</p> <ul> <li>MAJOR: Breaking changes to environment or filesystem structure</li> <li>MINOR: New features, tools, or non-breaking enhancements  </li> <li>PATCH: Bug fixes and minor updates</li> </ul> <p>The changelog format is based on Keep a Changelog.</p>"},{"location":"changelog/#quick-links","title":"Quick Links","text":"<ul> <li>\ud83d\udcc4 Full Changelog - Complete version history</li> <li>\ud83d\udccb Release Process - How releases are managed</li> <li>\ud83e\udd1d Contributing Guide - How to contribute</li> </ul> <p>Documentation Source of Truth</p> <p>See Documentation Source of Truth Guidelines for information about canonical documentation locations.</p>"},{"location":"examples/","title":"Examples","text":"<p>This page provides practical examples of using UBI in various scenarios.</p>"},{"location":"examples/#complete-example-projects","title":"\ud83d\udcda Complete Example Projects","text":"<p>For fully working example projects, see the examples directory:</p> <ul> <li>Python CLI - Simple command-line tool demonstrating Python development</li> <li>Node.js Express - REST API server showcasing Node.js development</li> <li>Polyglot - Multi-language project combining Python, Node.js, and Bash</li> </ul> <p>Each example includes complete source code, documentation, and devcontainer configuration ready to run.</p> <p>\ud83d\udc49 View all example projects \u2192</p>"},{"location":"examples/#basic-usage","title":"Basic Usage","text":""},{"location":"examples/#using-ubi-as-a-devcontainer-base","title":"Using UBI as a Devcontainer Base","text":"<p>The simplest way to use UBI is as your devcontainer base image:</p> .devcontainer/devcontainer.json<pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\",\n  \"customizations\": {\n    \"vscode\": {\n      \"extensions\": [\n        \"dbaeumer.vscode-eslint\"\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"examples/#using-ubi-as-a-dockerfile-base","title":"Using UBI as a Dockerfile Base","text":"<p>You can also extend UBI in your own Dockerfile:</p> Dockerfile<pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5\n\n# Install project-specific dependencies\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    nodejs \\\n    npm \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\n# Set working directory\nWORKDIR /workspace\n\n# Copy project files\nCOPY . .\n\n# Install dependencies\nRUN npm install\n</code></pre>"},{"location":"examples/#advanced-examples","title":"Advanced Examples","text":""},{"location":"examples/#multi-stage-build-with-ubi","title":"Multi-Stage Build with UBI","text":"<p>Use UBI as a build environment and create a minimal runtime image:</p> Dockerfile<pre><code># Build stage using UBI\nFROM ghcr.io/egohygiene/ubi:0.1.5 AS builder\n\nWORKDIR /build\nCOPY . .\nRUN make build\n\n# Runtime stage\nFROM debian:bookworm-slim\n\n# Copy artifacts from builder\nCOPY --from=builder /build/dist /app\n\nENTRYPOINT [\"/app/myapp\"]\n</code></pre>"},{"location":"examples/#using-xdg-paths","title":"Using XDG Paths","text":"<p>Leverage UBI's XDG-compliant directory structure:</p> example-script.sh<pre><code>#!/bin/bash\n\n# Use XDG environment variables\nCONFIG_FILE=\"${XDG_CONFIG_HOME}/myapp/config.yml\"\nCACHE_DIR=\"${XDG_CACHE_HOME}/myapp\"\nDATA_DIR=\"${XDG_DATA_HOME}/myapp\"\n\n# Create directories if they don't exist\nmkdir -p \"$(dirname \"$CONFIG_FILE\")\"\nmkdir -p \"$CACHE_DIR\"\nmkdir -p \"$DATA_DIR\"\n\n# Write configuration\ncat &gt; \"$CONFIG_FILE\" &lt;&lt;EOF\napp:\n  name: MyApp\n  cache_dir: $CACHE_DIR\n  data_dir: $DATA_DIR\nEOF\n</code></pre>"},{"location":"examples/#custom-environment-variables","title":"Custom Environment Variables","text":"<p>Add your own environment variables while preserving UBI's defaults:</p> .devcontainer/devcontainer.json<pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\",\n  \"containerEnv\": {\n    \"MY_APP_ENV\": \"development\",\n    \"MY_APP_DEBUG\": \"true\"\n  }\n}\n</code></pre>"},{"location":"examples/#project-specific-examples","title":"Project-Specific Examples","text":""},{"location":"examples/#python-project","title":"Python Project","text":"Dockerfile<pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5\n\n# Install Python dependencies\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\n# Set Python path to use XDG directories\nENV PYTHONUSERBASE=\"${XDG_DATA_HOME}/python\"\nENV PATH=\"${PYTHONUSERBASE}/bin:${PATH}\"\n\nWORKDIR /workspace\nCOPY . .\n</code></pre>"},{"location":"examples/#nodejs-project","title":"Node.js Project","text":"Dockerfile<pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5\n\n# Install Node.js\nRUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \\\n    &amp;&amp; apt-get install -y nodejs \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\n# Configure npm to use XDG directories\nENV NPM_CONFIG_USERCONFIG=\"${XDG_CONFIG_HOME}/npm/npmrc\"\nENV NPM_CONFIG_CACHE=\"${XDG_CACHE_HOME}/npm\"\nENV NPM_CONFIG_PREFIX=\"${XDG_DATA_HOME}/npm\"\n\nWORKDIR /workspace\nCOPY package*.json ./\nRUN npm install\n\nCOPY . .\n</code></pre>"},{"location":"examples/#go-project","title":"Go Project","text":"Dockerfile<pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5\n\n# Install Go\nARG GO_VERSION=1.22.0\nRUN wget -q https://go.dev/dl/go${GO_VERSION}.linux-amd64.tar.gz \\\n    &amp;&amp; tar -C /usr/local -xzf go${GO_VERSION}.linux-amd64.tar.gz \\\n    &amp;&amp; rm go${GO_VERSION}.linux-amd64.tar.gz\n\n# Configure Go to use XDG directories\nENV GOPATH=\"${XDG_DATA_HOME}/go\"\nENV GOCACHE=\"${XDG_CACHE_HOME}/go-build\"\nENV PATH=\"/usr/local/go/bin:${GOPATH}/bin:${PATH}\"\n\nWORKDIR /workspace\nCOPY go.* ./\nRUN go mod download\n\nCOPY . .\nRUN go build -o /app/myapp\n</code></pre>"},{"location":"examples/#cicd-examples","title":"CI/CD Examples","text":""},{"location":"examples/#github-actions","title":"GitHub Actions","text":"<p>Use UBI in your GitHub Actions workflows:</p> .github/workflows/ci.yml<pre><code>name: CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    container:\n      image: ghcr.io/egohygiene/ubi:0.1.5\n    steps:\n      - uses: actions/checkout@v4\n      - name: Run tests\n        run: |\n          make test\n</code></pre>"},{"location":"examples/#docker-compose","title":"Docker Compose","text":"<p>Use UBI with Docker Compose for local development:</p> docker-compose.yml<pre><code>version: '3.8'\n\nservices:\n  app:\n    image: ghcr.io/egohygiene/ubi:0.1.5\n    volumes:\n      - .:/workspace\n      - ubi-cache:/opt/universal/cache\n      - ubi-config:/opt/universal/config\n    working_dir: /workspace\n    command: bash\n\nvolumes:\n  ubi-cache:\n  ubi-config:\n</code></pre>"},{"location":"examples/#testing-examples","title":"Testing Examples","text":""},{"location":"examples/#local-testing","title":"Local Testing","text":"<p>Test your changes with UBI locally:</p> <pre><code># Build your custom image\ndocker build -f Dockerfile -t myapp:test .\n\n# Run interactively\ndocker run -it --rm myapp:test bash\n\n# Verify XDG paths\ndocker run --rm myapp:test bash -c 'echo $XDG_CONFIG_HOME'\n\n# Check directory structure\ndocker run --rm myapp:test ls -la /opt/universal/\n</code></pre>"},{"location":"examples/#integration-testing","title":"Integration Testing","text":"<p>Test your application with UBI in CI:</p> .github/workflows/integration.yml<pre><code>name: Integration Tests\n\non: [push, pull_request]\n\njobs:\n  integration:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Build test image\n        run: docker build -f Dockerfile -t myapp:test .\n\n      - name: Run integration tests\n        run: |\n          docker run --rm myapp:test make integration-test\n</code></pre>"},{"location":"examples/#best-practices","title":"Best Practices","text":""},{"location":"examples/#version-pinning","title":"Version Pinning","text":"<p>Always pin to a specific version in production:</p> <pre><code># \u2705 Good - pinned version\nFROM ghcr.io/egohygiene/ubi:0.1.5\n\n# \u274c Avoid - using latest in production\nFROM ghcr.io/egohygiene/ubi:latest\n</code></pre>"},{"location":"examples/#layer-optimization","title":"Layer Optimization","text":"<p>Optimize your Dockerfile layers:</p> <pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5\n\n# Combine RUN commands to reduce layers\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    package1 \\\n    package2 \\\n    package3 \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\n# Use .dockerignore to exclude unnecessary files\nCOPY . .\n</code></pre>"},{"location":"examples/#security","title":"Security","text":"<p>Keep security in mind:</p> <pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5\n\n# Don't run as root\nUSER vscode\n\n# Use COPY instead of ADD\nCOPY --chown=vscode:vscode . /workspace\n\n# Clean up sensitive data\nRUN rm -rf /tmp/* /var/tmp/*\n</code></pre>"},{"location":"examples/#troubleshooting-examples","title":"Troubleshooting Examples","text":""},{"location":"examples/#permission-issues","title":"Permission Issues","text":"<p>If you encounter permission issues:</p> <pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5\n\n# Ensure proper ownership\nRUN chown -R vscode:vscode /opt/universal/\n\n# Or run as root temporarily\nUSER root\nRUN apt-get update &amp;&amp; apt-get install -y mypackage\nUSER vscode\n</code></pre>"},{"location":"examples/#missing-dependencies","title":"Missing Dependencies","text":"<p>Install missing dependencies:</p> <pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5\n\n# Install system dependencies\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    build-essential \\\n    git \\\n    curl \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n</code></pre>"},{"location":"examples/#additional-resources","title":"Additional Resources","text":"<ul> <li>Architecture Documentation</li> <li>Troubleshooting Guide</li> <li>Contributing Guide</li> </ul> <p>For more examples and use cases, check the examples directory in the repository.</p>"},{"location":"license/","title":"License","text":"<p>Canonical Source</p> <p>This page references the canonical license file maintained in the repository root.</p> <p>\ud83d\udcc4 View the full LICENSE \u2192</p> <p>UBI (Universal Base Image) is licensed under the MIT License.</p>"},{"location":"license/#license-summary","title":"License Summary","text":"<p>Copyright \u00a9 2025 Ego Hygiene</p> <p>The MIT License is a permissive free software license that allows you to:</p> <ul> <li>\u2705 Use commercially</li> <li>\u2705 Modify</li> <li>\u2705 Distribute</li> <li>\u2705 Use privately</li> <li>\u2705 Sublicense</li> </ul> <p>With the requirement to:</p> <ul> <li>\ud83d\udccb Include the original copyright and license notice</li> </ul> <p>For the complete legal text, see the LICENSE file in the repository root.</p>"},{"location":"license/#third-party-licenses","title":"Third-Party Licenses","text":"<p>UBI builds upon the following open-source projects:</p>"},{"location":"license/#base-image","title":"Base Image","text":"<ul> <li>Microsoft DevContainers Base Image - MIT License</li> </ul>"},{"location":"license/#documentation-tools","title":"Documentation Tools","text":"<ul> <li>MkDocs - BSD License</li> <li>MkDocs Material - MIT License</li> </ul>"},{"location":"license/#contributing","title":"Contributing","text":"<p>By contributing to UBI, you agree that your contributions will be licensed under the MIT License.</p> <p>See our Contributing Guide for more information.</p> <p>Documentation Source of Truth</p> <p>See Documentation Source of Truth Guidelines for information about canonical documentation locations.</p>"},{"location":"release-process/","title":"Release Process","text":"<p>This document describes the complete release process for UBI, from version bumping to publishing the container image to GitHub Container Registry (GHCR).</p>"},{"location":"release-process/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>VERSION File Rules</li> <li>Semantic Versioning</li> <li>Version Bump Workflow</li> <li>Publish Pipeline</li> <li>GitHub Release Creation</li> <li>SBOM Generation</li> <li>Release Checklist</li> <li>Troubleshooting</li> </ul>"},{"location":"release-process/#overview","title":"Overview","text":"<p>UBI uses a fully automated release pipeline that follows this flow:</p> <pre><code>graph TD\n    A[Manual: Trigger Version Bump] --&gt; B[bump-my-version updates files]\n    B --&gt; C[Commit with version changes]\n    C --&gt; D[Create Git Tag]\n    D --&gt; E[Push to GitHub]\n    E --&gt; F[\ud83e\uddea Unified Container Testing]\n    E --&gt; K[\ud83d\udcdd Create GitHub Release]\n    F --&gt; O[Run Tests on All Variants]\n    O --&gt; P{Tests Pass?}\n    P --&gt;|Yes| Q[\ud83d\udd12 Container Vulnerability Scan]\n    P --&gt;|No| R[Block Pipeline]\n    Q --&gt; S[Scan for Security Issues]\n    S --&gt; T{Scan Pass?}\n    T --&gt;|Yes| U[\ud83d\ude80 Publish UBI Image]\n    T --&gt;|No| R\n    U --&gt; G[Build Multi-Platform Image]\n    G --&gt; H[Generate SBOM]\n    H --&gt; I[Push to GHCR]\n    I --&gt; J[Tag: latest, version, sha-XXX]\n    K --&gt; L[Extract CHANGELOG section]\n    L --&gt; M[Wait for Publish to complete]\n    M --&gt; N[Create GitHub Release with SBOM]</code></pre> <p>Key Principles:</p> <ul> <li>Single source of truth: <code>VERSION</code> file</li> <li>Automated synchronization across files</li> <li>Git tags trigger image publishing</li> <li>Semantic versioning (SemVer) enforced</li> <li>Quality gates: Tests and security scans must pass before publishing</li> </ul>"},{"location":"release-process/#version-file-rules","title":"VERSION File Rules","text":"<p>The <code>VERSION</code> file at the repository root is the single source of truth for the current version.</p>"},{"location":"release-process/#format","title":"Format","text":"<pre><code>0.1.5\n</code></pre> <p>Rules:</p> <ul> <li>Plain text file, no comments</li> <li>Single line with semantic version number</li> <li>Format: <code>MAJOR.MINOR.PATCH</code> (e.g., <code>0.1.5</code>)</li> <li>Trailing newline (Unix line ending: LF)</li> <li>No whitespace except trailing newline</li> <li>No prefixes (no <code>v</code> prefix)</li> </ul>"},{"location":"release-process/#valid-examples","title":"Valid Examples","text":"<pre><code># \u2705 Valid\n0.1.5\n\n1.0.0\n\n2.3.1\n</code></pre>"},{"location":"release-process/#invalid-examples","title":"Invalid Examples","text":"<pre><code># \u274c Invalid\nv0.1.5          # No prefix allowed\n0.1.5-beta      # No pre-release tags\n 0.1.5          # No leading whitespace\n0.1.5 \\n\\n      # Only one trailing newline\n</code></pre>"},{"location":"release-process/#checking-version-file","title":"Checking VERSION File","text":"<pre><code># View content with visible whitespace\ncat -A VERSION\n\n# Should output ($ represents newline):\n# 0.1.5$\n\n# Verify format\nif [[ $(cat VERSION) =~ ^[0-9]+\\.[0-9]+\\.[0-9]+$ ]]; then\n  echo \"\u2705 Valid\"\nelse\n  echo \"\u274c Invalid format\"\nfi\n</code></pre>"},{"location":"release-process/#semantic-versioning","title":"Semantic Versioning","text":"<p>UBI follows Semantic Versioning 2.0.0.</p>"},{"location":"release-process/#version-format","title":"Version Format","text":"<pre><code>MAJOR.MINOR.PATCH\n</code></pre> <p>Note: Pre-release versions (e.g., <code>1.0.0-alpha</code>, <code>2.0.0-beta.1</code>) are not supported based on the VERSION file format rules. Only stable release versions are allowed.</p>"},{"location":"release-process/#when-to-bump-each-component","title":"When to Bump Each Component","text":""},{"location":"release-process/#major-version-x00","title":"MAJOR version (X.0.0)","text":"<p>Increment for breaking changes that require consumers to modify their setup:</p> <ul> <li>Changes to <code>/opt/universal</code> directory structure</li> <li>Removal or renaming of environment variables</li> <li>Changes to base image that break compatibility</li> <li>Removal of previously supported features</li> </ul> <p>Example: Moving from <code>/opt/universal/bin</code> to <code>/opt/ubi/bin</code> \u2192 <code>1.0.0</code></p>"},{"location":"release-process/#minor-version-0x0","title":"MINOR version (0.X.0)","text":"<p>Increment for new features that are backwards-compatible:</p> <ul> <li>Addition of new environment variables</li> <li>Addition of new directories in <code>/opt/universal</code></li> <li>New tools or utilities installed</li> <li>Non-breaking enhancements to existing features</li> </ul> <p>Example: Adding new telemetry opt-outs \u2192 <code>0.2.0</code></p>"},{"location":"release-process/#patch-version-00x","title":"PATCH version (0.0.X)","text":"<p>Increment for bug fixes and minor updates:</p> <ul> <li>Security patches to base image</li> <li>Bug fixes that don't change functionality</li> <li>Documentation updates</li> <li>Internal refactoring without external impact</li> <li>Dependency updates (if no behavior change)</li> </ul> <p>Example: Fixing a typo in environment variable \u2192 <code>0.0.6</code></p>"},{"location":"release-process/#special-cases","title":"Special Cases","text":"<ul> <li>Pre-1.0.0: Breaking changes are allowed in MINOR versions</li> <li><code>0.1.0</code> \u2192 <code>0.2.0</code> can include breaking changes</li> <li> <p>After <code>1.0.0</code>, breaking changes require MAJOR bump</p> </li> <li> <p>Security Fixes:</p> </li> <li>If critical, may warrant out-of-band patch release</li> <li>Document clearly in CHANGELOG</li> </ul>"},{"location":"release-process/#version-bump-workflow","title":"Version Bump Workflow","text":"<p>Version bumping is handled by the <code>bump-version.yml</code> GitHub Actions workflow.</p>"},{"location":"release-process/#triggering-a-version-bump","title":"Triggering a Version Bump","text":"<ol> <li>Navigate to Actions tab in GitHub:</li> <li>Go to: https://github.com/egohygiene/ubi/actions</li> <li> <p>Select \"\ud83d\udd3c Bump UBI Version\" workflow</p> </li> <li> <p>Click \"Run workflow\"</p> </li> <li> <p>Select bump type:</p> </li> <li><code>major</code> - For breaking changes (X.0.0)</li> <li><code>minor</code> - For new features (0.X.0)</li> <li> <p><code>patch</code> - For bug fixes (0.0.X)</p> </li> <li> <p>Click \"Run workflow\" button</p> </li> </ol>"},{"location":"release-process/#what-happens-automatically","title":"What Happens Automatically","text":"<p>The workflow performs these steps:</p> <ol> <li> <p>Checkout repository with full git history</p> </li> <li> <p>Install bump-my-version:</p> </li> </ol> <pre><code>pip install bump-my-version\n</code></pre> <ol> <li>Bump version using configuration in <code>pyproject.toml</code>:</li> </ol> <pre><code>bump-my-version [major|minor|patch]\n</code></pre> <ol> <li>Files updated automatically:</li> <li><code>VERSION</code> - Updated to new version</li> <li><code>pyproject.toml</code> - Updated in two places:<ul> <li><code>[tool.poetry] version</code></li> <li><code>[tool.bumpversion] current_version</code></li> </ul> </li> <li> <p><code>CHANGELOG.md</code> - New version section inserted at top</p> </li> <li> <p>Create commit:</p> </li> </ol> <pre><code>chore: bump version to X.Y.Z\n</code></pre> <ol> <li>Create git tag:</li> </ol> <pre><code>X.Y.Z\n</code></pre> <ol> <li>Push commit and tag to main branch</li> </ol>"},{"location":"release-process/#configuration","title":"Configuration","text":"<p>Version bump behavior is configured in <code>pyproject.toml</code>:</p> <pre><code>[tool.bumpversion]\ncurrent_version = \"0.1.5\"\nparse = \"^(?P&lt;major&gt;\\\\d+)\\\\.(?P&lt;minor&gt;\\\\d+)\\\\.(?P&lt;patch&gt;\\\\d+)$\"\nserialize = [\"{major}.{minor}.{patch}\"]\ncommit = true\nmessage = \"chore: bump version to {new_version}\"\ntag = false  # Tagging done by CI\n\n[[tool.bumpversion.files]]\nfilename = \"VERSION\"\nsearch = \"{current_version}\"\nreplace = \"{new_version}\"\n\n[[tool.bumpversion.files]]\nfilename = \"CHANGELOG.md\"\nregex = true\nsearch = \"\\\\A## \"\nreplace = \"\"\"## {new_version} ({now:%Y-%m-%d})\n[Compare the full difference.](https://github.com/egohygiene/ubi/compare/{current_version}...{new_version})\n\n## \"\"\"\n</code></pre>"},{"location":"release-process/#local-version-bump-testing","title":"Local Version Bump (Testing)","text":"<p>To test version bumps locally without pushing:</p> <pre><code># Install tool\npip install bump-my-version\n\n# Dry run (no changes)\nbump-my-version patch --dry-run --verbose\n\n# Actually bump (creates commit, no tag)\nbump-my-version patch\n\n# Undo if needed\ngit reset --hard HEAD~1\n</code></pre>"},{"location":"release-process/#publish-pipeline","title":"Publish Pipeline","text":"<p>The <code>publish.yml</code> workflow builds and publishes the UBI image to GHCR.</p>"},{"location":"release-process/#workflow-dependencies","title":"Workflow Dependencies","text":"<p>UBI implements a chained CI/CD pipeline with quality gates to ensure only tested and secure images are published:</p> <pre><code>test-unified.yml \u2192 trivy-scan.yml \u2192 publish.yml\n</code></pre> <p>Pipeline Flow:</p> <ol> <li>\ud83e\uddea Unified Container Testing (<code>test-unified.yml</code>)</li> <li>Runs comprehensive tests on all variants</li> <li>Validates directory structure, environment variables, permissions</li> <li> <p>Executes Goss container tests</p> </li> <li> <p>\ud83d\udd12 Container Vulnerability Scan (<code>trivy-scan.yml</code>)</p> </li> <li>Dependency: Only runs after tests pass</li> <li>Scans image for security vulnerabilities</li> <li> <p>Fails on CRITICAL or HIGH severity issues</p> </li> <li> <p>\ud83d\ude80 Publish UBI Image (<code>publish.yml</code>)</p> </li> <li>Dependency: Only runs after security scan passes</li> <li>Builds and publishes multi-platform images</li> <li>Generates SBOM and signs images with Cosign</li> </ol> <p>Benefits:</p> <ul> <li>\u2705 Prevents publishing broken images</li> <li>\u2705 Prevents publishing insecure images</li> <li>\u2705 Automated quality assurance</li> <li>\u2705 Reduced risk in production</li> </ul>"},{"location":"release-process/#triggers","title":"Triggers","text":"<p>The publish workflow runs automatically on:</p> <ul> <li>Successful completion of security scan (workflow_run after \ud83d\udd12 Container Vulnerability Scan succeeds)</li> <li>Tag creation (direct trigger for tagged releases)</li> <li>Manual trigger (workflow_dispatch for emergency publishes)</li> </ul>"},{"location":"release-process/#build-process","title":"Build Process","text":"<ol> <li> <p>Checkout repository</p> </li> <li> <p>Read VERSION file:</p> </li> </ol> <pre><code>VERSION=$(cat VERSION | tr -d '[:space:]')\n</code></pre> <ol> <li>Set up build environment:</li> <li>QEMU for multi-architecture support</li> <li> <p>Docker Buildx for multi-platform builds</p> </li> <li> <p>Authenticate to GHCR:</p> </li> </ol> <pre><code>echo $GITHUB_TOKEN | docker login ghcr.io -u ${{ github.repository_owner }} --password-stdin\n</code></pre> <ol> <li>Generate metadata (tags and labels):</li> </ol> <pre><code>tags: |\n  type=raw,value=latest\n  type=raw,value=${{ VERSION }}\n  type=sha\n</code></pre> <ol> <li>Build multi-platform image:</li> <li>Platforms: <code>linux/amd64</code>, <code>linux/arm64</code></li> <li>Context: Repository root</li> <li> <p>Dockerfile: <code>.devcontainer/Dockerfile</code></p> </li> <li> <p>Push to GHCR with multiple tags:</p> </li> </ol> <pre><code>ghcr.io/egohygiene/ubi:latest\nghcr.io/egohygiene/ubi:0.1.5\nghcr.io/egohygiene/ubi:sha-abc123\n</code></pre>"},{"location":"release-process/#published-tags","title":"Published Tags","text":"<p>Every release creates three tags:</p> Tag Format Example Purpose <code>latest</code> <code>ghcr.io/egohygiene/ubi:latest</code> Always points to newest stable release <code>X.Y.Z</code> <code>ghcr.io/egohygiene/ubi:0.1.5</code> Pinned version for reproducibility <code>sha-XXXXXX</code> <code>ghcr.io/egohygiene/ubi:sha-abc123</code> Git commit SHA for exact reproducibility"},{"location":"release-process/#recommendations","title":"Recommendations","text":"<ul> <li>Production: Use specific version tags (<code>0.1.5</code>)</li> <li>Development: Use <code>latest</code> for convenience</li> <li>Maximum reproducibility: Use <code>sha-XXXXXX</code> tags</li> </ul>"},{"location":"release-process/#github-release-creation","title":"GitHub Release Creation","text":"<p>The <code>release-notes.yml</code> workflow automatically creates GitHub Releases with release notes.</p>"},{"location":"release-process/#triggers_1","title":"Triggers","text":"<p>The release notes workflow runs automatically on:</p> <ul> <li>Tag creation (when version bump workflow creates a tag)</li> </ul>"},{"location":"release-process/#release-creation-process","title":"Release Creation Process","text":"<ol> <li> <p>Checkout repository at the tagged version</p> </li> <li> <p>Extract version from tag:</p> </li> </ol> <pre><code>TAG_NAME=\"${GITHUB_REF#refs/tags/}\"\nVERSION=\"${TAG_NAME#v}\"  # Remove 'v' prefix if present\n</code></pre> <ol> <li>Extract changelog section for this version:</li> </ol> <p>Uses <code>awk</code> to extract the section between <code>## VERSION</code> headers in CHANGELOG.md</p> <ol> <li>Wait for publish workflow to complete:</li> </ol> <p>Ensures the container image and SBOM are available before creating the release</p> <ol> <li>Download SBOM artifacts:</li> </ol> <p>Fetches all variant SBOMs generated by the publish workflow:    - <code>ubi-base-sbom-X.Y.Z</code>    - <code>ubi-minimal-sbom-X.Y.Z</code>    - <code>ubi-python-sbom-X.Y.Z</code>    - <code>ubi-node-sbom-X.Y.Z</code>    - <code>ubi-full-sbom-X.Y.Z</code></p> <ol> <li> <p>Create GitHub Release:</p> </li> <li> <p>Title: Version number (e.g., <code>0.1.5</code>)</p> </li> <li>Body: Extracted changelog section</li> <li>Assets: SBOM files for all variants (if available)</li> <li>Additional info: Container image pull instructions, variant descriptions, tags, and links</li> </ol>"},{"location":"release-process/#release-contents","title":"Release Contents","text":"<p>Each GitHub Release includes:</p> <ul> <li>Release Notes: Extracted from CHANGELOG.md</li> <li>SBOM Attachments: Software Bill of Materials in SPDX-JSON format for each variant:</li> <li><code>ubi-base-sbom-X.Y.Z.spdx.json</code></li> <li><code>ubi-minimal-sbom-X.Y.Z.spdx.json</code></li> <li><code>ubi-python-sbom-X.Y.Z.spdx.json</code></li> <li><code>ubi-node-sbom-X.Y.Z.spdx.json</code></li> <li><code>ubi-full-sbom-X.Y.Z.spdx.json</code></li> <li>Container Image Info: Pull instructions for all variants and tags</li> <li>Links:</li> <li>Compare changes</li> <li>Full CHANGELOG.md</li> <li>Documentation</li> <li>Security Overview</li> </ul>"},{"location":"release-process/#accessing-releases","title":"Accessing Releases","text":"<ol> <li>GitHub Releases Page:</li> <li>Visit: https://github.com/egohygiene/ubi/releases</li> <li>View all releases and their notes</li> <li> <p>Download SBOM attachments</p> </li> <li> <p>Latest Release:</p> </li> <li> <p>Direct link: https://github.com/egohygiene/ubi/releases/latest</p> </li> <li> <p>Specific Version:</p> </li> <li>Format: <code>https://github.com/egohygiene/ubi/releases/tag/X.Y.Z</code></li> <li>Example: https://github.com/egohygiene/ubi/releases/tag/0.1.5</li> </ol>"},{"location":"release-process/#sbom-generation","title":"SBOM Generation","text":"<p>A Software Bill of Materials (SBOM) is generated for every published UBI variant.</p>"},{"location":"release-process/#what-is-an-sbom","title":"What is an SBOM?","text":"<p>An SBOM is a formal, machine-readable inventory of:</p> <ul> <li>All software components in the image</li> <li>Package names and versions</li> <li>Dependencies and relationships</li> <li>License information</li> <li>Security vulnerability data</li> </ul>"},{"location":"release-process/#generation-process","title":"Generation Process","text":"<p>The publish workflow uses Syft to generate SBOMs for each variant:</p> <pre><code>- name: Generate SBOM with Syft\n  uses: anchore/sbom-action@v0\n  with:\n    image: ghcr.io/egohygiene/ubi:${{ VERSION }}${{ variant.suffix }}\n    format: spdx-json\n    output-file: ubi-${{ variant.name }}-sbom.spdx.json\n</code></pre> <p>Variants: - base - Base UBI image (no suffix) - minimal - Minimal footprint variant (<code>-minimal</code> suffix) - python - Python development environment (<code>-python</code> suffix) - node - Node.js development environment (<code>-node</code> suffix) - full - Full-featured environment (<code>-full</code> suffix)</p>"},{"location":"release-process/#sbom-format","title":"SBOM Format","text":"<ul> <li>Format: SPDX-JSON (Software Package Data Exchange)</li> <li>Standard: SPDX 2.3</li> <li>Output: <code>ubi-{variant}-sbom.spdx.json</code></li> </ul>"},{"location":"release-process/#accessing-sboms","title":"Accessing SBOMs","text":"<ol> <li>GitHub Release Assets (Recommended):</li> </ol> <p>Download pre-generated SBOMs from any release:</p> <pre><code># Set your desired version\nVERSION=\"0.1.5\"\n\n# Download SBOM for base variant\ncurl -L -O \"https://github.com/egohygiene/ubi/releases/download/${VERSION}/ubi-base-sbom-${VERSION}.spdx.json\"\n\n# Download SBOM for python variant\ncurl -L -O \"https://github.com/egohygiene/ubi/releases/download/${VERSION}/ubi-python-sbom-${VERSION}.spdx.json\"\n</code></pre> <p>Benefits:    - Permanently archived with each release    - Cryptographically tied to image digest    - No need to generate locally</p> <ol> <li>Workflow Artifacts:</li> <li>Navigate to workflow run: https://github.com/egohygiene/ubi/actions/workflows/publish.yml</li> <li>Download artifact: <code>ubi-{variant}-sbom-X.Y.Z</code></li> <li> <p>Retention: 90 days</p> </li> <li> <p>Generate Locally:</p> </li> </ol> <pre><code># Install Syft\nbrew install syft  # macOS\n# or\ncurl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh | sh -s -- -b /usr/local/bin\n\n# Set your desired version\nVERSION=\"0.1.5\"\n\n# Generate SBOM for base variant\nsyft \"ghcr.io/egohygiene/ubi:${VERSION}\" -o spdx-json &gt; \"ubi-base-sbom-${VERSION}.json\"\n\n# Generate SBOM for python variant\nsyft \"ghcr.io/egohygiene/ubi:${VERSION}-python\" -o spdx-json &gt; \"ubi-python-sbom-${VERSION}.json\"\n</code></pre>"},{"location":"release-process/#sbom-use-cases","title":"SBOM Use Cases","text":"<ul> <li>Supply chain security: Track all components in each variant</li> <li>Vulnerability management: Cross-reference with CVE databases per variant</li> <li>Compliance: Meet regulatory requirements (NIST, CIS, SLSA)</li> <li>Auditing: Verify what's in production images</li> <li>License compliance: Identify OSS licenses in your chosen variant</li> <li>Variant comparison: Understand differences between UBI variants</li> </ul>"},{"location":"release-process/#release-checklist","title":"Release Checklist","text":"<p>Use this checklist when preparing a release:</p>"},{"location":"release-process/#pre-release","title":"Pre-Release","text":"<ul> <li> All changes merged to main branch</li> <li> CI/CD workflows passing (build, test, security scan)</li> <li> Documentation updated (if applicable)</li> <li> CHANGELOG manually updated with release notes (optional, bump-my-version adds header)</li> <li> Tested image locally</li> </ul>"},{"location":"release-process/#release","title":"Release","text":"<ul> <li> Determine bump type (major/minor/patch)</li> <li> Trigger \"\ud83d\udd3c Bump UBI Version\" workflow with correct type</li> <li> Verify workflow completes successfully</li> <li> Confirm commit and tag created in repository</li> <li> Wait for \"\ud83e\uddea Unified Container Testing\" workflow to trigger</li> <li> Verify all tests pass across all variants</li> <li> Wait for \"\ud83d\udd12 Container Vulnerability Scan\" workflow to trigger (after tests pass)</li> <li> Verify security scan passes with no critical/high vulnerabilities</li> <li> Wait for \"\ud83d\ude80 Publish UBI Image\" workflow to trigger (after scan passes)</li> <li> Verify publish workflow completes successfully</li> <li> Wait for \"\ud83d\udcdd Create GitHub Release\" workflow to trigger</li> <li> Verify GitHub Release is created with correct notes and SBOM</li> </ul>"},{"location":"release-process/#post-release","title":"Post-Release","text":"<ul> <li> Verify image available on GHCR:</li> </ul> <pre><code>docker pull ghcr.io/egohygiene/ubi:latest\ndocker pull ghcr.io/egohygiene/ubi:X.Y.Z\n</code></pre> <ul> <li> Test pulled image:</li> </ul> <pre><code>docker run -it --rm ghcr.io/egohygiene/ubi:X.Y.Z bash\n</code></pre> <ul> <li> Verify SBOM artifacts uploaded for all variants</li> <li> Check GitHub Release page for release notes and all SBOM attachments</li> <li> Update dependent projects (if needed)</li> <li> Announce release (if significant)</li> </ul>"},{"location":"release-process/#troubleshooting","title":"Troubleshooting","text":""},{"location":"release-process/#version-bump-fails","title":"Version Bump Fails","text":"<p>Problem: Workflow fails at bump step</p> <p>Solutions:</p> <ol> <li>Check <code>pyproject.toml</code> configuration matches VERSION file</li> <li>Verify VERSION file format is correct</li> <li>Review workflow logs for specific error</li> <li>See Troubleshooting Guide</li> </ol>"},{"location":"release-process/#publish-fails-to-push-image","title":"Publish Fails to Push Image","text":"<p>Problem: Image builds but doesn't push to GHCR</p> <p>Solutions:</p> <ol> <li>Verify workflow has <code>packages: write</code> permission</li> <li>Check GHCR authentication</li> <li>Confirm image size is within limits</li> <li>Review Docker Buildx logs</li> </ol>"},{"location":"release-process/#tag-already-exists","title":"Tag Already Exists","text":"<p>Problem: Cannot create tag because it already exists</p> <p>Solutions:</p> <ol> <li>Verify you're bumping the correct version component</li> <li>Delete tag if needed:</li> </ol> <pre><code>git tag -d X.Y.Z\ngit push origin :refs/tags/X.Y.Z\n</code></pre> <ol> <li>Re-run bump workflow</li> </ol>"},{"location":"release-process/#sbom-generation-fails","title":"SBOM Generation Fails","text":"<p>Problem: SBOM step fails in publish workflow</p> <p>Solutions:</p> <ol> <li>Check if image was successfully built</li> <li>Verify Syft action version</li> <li>Review Syft logs for specific errors</li> <li>Try generating SBOM manually (see above)</li> </ol>"},{"location":"release-process/#github-release-not-created","title":"GitHub Release Not Created","text":"<p>Problem: Tag is pushed but GitHub Release is not created</p> <p>Solutions:</p> <ol> <li>Check if \"\ud83d\udcdd Create GitHub Release\" workflow was triggered</li> <li>Review workflow logs in Actions tab</li> <li>Verify CHANGELOG.md has an entry for this version</li> <li>Check if publish workflow completed successfully (release workflow waits for it)</li> <li>Manually create release if needed:</li> <li>Go to https://github.com/egohygiene/ubi/releases/new</li> <li>Select the tag</li> <li>Copy content from CHANGELOG.md</li> <li>Attach SBOM from workflow artifacts</li> </ol>"},{"location":"release-process/#release-missing-sboms","title":"Release Missing SBOMs","text":"<p>Problem: GitHub Release created but SBOMs are not attached</p> <p>Solutions:</p> <ol> <li>Check if publish workflow completed successfully for all variants</li> <li>Verify SBOM artifacts were uploaded in publish workflow (check for all 5 variants)</li> <li>Check release-notes workflow logs for artifact download steps</li> <li>Download SBOMs from publish workflow artifacts and manually attach to release:    <pre><code># Download each variant SBOM from workflow artifacts\n# Then attach to release via GitHub UI\n</code></pre></li> </ol>"},{"location":"release-process/#publish-workflow-not-triggered","title":"Publish Workflow Not Triggered","text":"<p>Problem: Tests and security scans pass but publish workflow doesn't run</p> <p>Solutions:</p> <ol> <li>Verify the triggering workflow (trivy-scan.yml) completed successfully</li> <li>Check that the branch is <code>main</code> or <code>master</code> (workflow_run triggers are branch-specific)</li> <li>Review GitHub Actions logs for workflow_run trigger events</li> <li>Manually trigger publish workflow using workflow_dispatch:</li> <li>Go to: https://github.com/egohygiene/ubi/actions/workflows/publish.yml</li> <li>Click \"Run workflow\"</li> <li>Select branch and run</li> </ol>"},{"location":"release-process/#tests-or-security-scan-failing","title":"Tests or Security Scan Failing","text":"<p>Problem: Pipeline blocked because tests or security scan failed</p> <p>Solutions:</p> <ol> <li>For test failures:</li> <li>Review test-unified.yml workflow logs</li> <li>Identify which variant or test is failing</li> <li>Fix the issue in code</li> <li> <p>Push fix to trigger new test run</p> </li> <li> <p>For security scan failures:</p> </li> <li>Review trivy-scan.yml workflow logs</li> <li>Check SARIF report in GitHub Security tab</li> <li>Address CRITICAL or HIGH vulnerabilities</li> <li>Update base image or dependencies</li> <li> <p>Push fix to trigger new scan</p> </li> <li> <p>Emergency publish (use with caution):</p> </li> <li>Only if fix will take significant time</li> <li>Use workflow_dispatch to manually trigger publish</li> <li>Document known issues in release notes</li> <li>Create follow-up issue to fix properly</li> </ol>"},{"location":"release-process/#manual-release-emergency","title":"Manual Release (Emergency)","text":"<p>In case automated workflows fail, you can perform a manual release:</p>"},{"location":"release-process/#1-manual-version-bump","title":"1. Manual Version Bump","text":"<pre><code># Update VERSION file\necho \"0.1.6\" &gt; VERSION\n\n# Update pyproject.toml manually\n# Edit [tool.poetry] version and [tool.bumpversion] current_version\n\n# Update CHANGELOG.md (add new section at top)\n\n# Commit\ngit add VERSION pyproject.toml CHANGELOG.md\ngit commit -m \"chore: bump version to 0.1.6\"\n\n# Tag\ngit tag 0.1.6\n\n# Push\ngit push origin main\ngit push origin 0.1.6\n</code></pre>"},{"location":"release-process/#2-manual-image-build-and-push","title":"2. Manual Image Build and Push","text":"<pre><code># Read version\nVERSION=$(cat VERSION | tr -d '[:space:]')\n\n# Login to GHCR\necho $GITHUB_TOKEN | docker login ghcr.io -u USERNAME --password-stdin\n\n# Build multi-platform\ndocker buildx build \\\n  --platform linux/amd64,linux/arm64 \\\n  --file .devcontainer/Dockerfile \\\n  --tag ghcr.io/egohygiene/ubi:latest \\\n  --tag ghcr.io/egohygiene/ubi:$VERSION \\\n  --push \\\n  .\n</code></pre>"},{"location":"release-process/#3-manual-sbom-generation","title":"3. Manual SBOM Generation","text":"<pre><code># Generate SBOMs for all variants\nVERSION=$(cat VERSION | tr -d '[:space:]')\n\nsyft ghcr.io/egohygiene/ubi:$VERSION -o spdx-json &gt; ubi-base-sbom-$VERSION.spdx.json\nsyft ghcr.io/egohygiene/ubi:$VERSION-minimal -o spdx-json &gt; ubi-minimal-sbom-$VERSION.spdx.json\nsyft ghcr.io/egohygiene/ubi:$VERSION-python -o spdx-json &gt; ubi-python-sbom-$VERSION.spdx.json\nsyft ghcr.io/egohygiene/ubi:$VERSION-node -o spdx-json &gt; ubi-node-sbom-$VERSION.spdx.json\nsyft ghcr.io/egohygiene/ubi:$VERSION-full -o spdx-json &gt; ubi-full-sbom-$VERSION.spdx.json\n</code></pre>"},{"location":"release-process/#best-practices","title":"Best Practices","text":"<ol> <li>Always use the workflow for releases (avoid manual steps)</li> <li>Test locally first before bumping version</li> <li>Write clear CHANGELOG entries explaining changes</li> <li>Follow SemVer strictly for predictability</li> <li>Verify images work before announcing releases</li> <li>Keep VERSION file clean (no extra whitespace)</li> <li>Document breaking changes prominently in CHANGELOG</li> <li>Use specific tags in production, not <code>latest</code></li> <li>Monitor the full pipeline - ensure all quality gates pass</li> <li>Don't bypass quality gates - use manual publish only in emergencies</li> </ol>"},{"location":"release-process/#additional-resources","title":"Additional Resources","text":"<ul> <li>Semantic Versioning 2.0.0</li> <li>bump-my-version Documentation</li> <li>GitHub Actions Workflows</li> <li>Troubleshooting Guide</li> <li>Architecture Documentation</li> </ul>"},{"location":"security-overview/","title":"Security Overview","text":"<p>This document provides an overview of UBI's security practices, threat model, and security-related configurations.</p>"},{"location":"security-overview/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Security Philosophy</li> <li>Threat Model</li> <li>Container Security</li> <li>Vulnerability Scanning</li> <li>Software Bill of Materials (SBOM)</li> <li>Supply Chain Security</li> <li>Future Enhancements</li> <li>Reporting Vulnerabilities</li> </ul>"},{"location":"security-overview/#security-philosophy","title":"Security Philosophy","text":"<p>UBI follows a defense-in-depth approach with multiple layers of security:</p> <ol> <li>Principle of Least Privilege: Run with minimal necessary permissions</li> <li>Transparency: SBOM generation for full supply chain visibility</li> <li>Proactive Scanning: Automated vulnerability detection</li> <li>Reproducibility: Pinned dependencies prevent supply chain attacks</li> <li>Regular Updates: Keep base image and dependencies current</li> </ol> <p>Key Principle: Security is a continuous process, not a one-time configuration.</p>"},{"location":"security-overview/#threat-model","title":"Threat Model","text":""},{"location":"security-overview/#assets-to-protect","title":"Assets to Protect","text":"<ul> <li>Host System: The machine running the container</li> <li>Container Runtime: Docker daemon and orchestration layer</li> <li>Source Code: Developer's projects in <code>/workspace</code></li> <li>Credentials: Git tokens, API keys, SSH keys</li> <li>Build Artifacts: Compiled code and dependencies</li> </ul>"},{"location":"security-overview/#threats-considered","title":"Threats Considered","text":"Threat Mitigation Status Container escape No privileged mode, standard isolation \u2705 Implemented Supply chain attack Pinned base image with digest \u2705 Implemented Vulnerable dependencies Automated Trivy scanning \u2705 Implemented Malicious packages SBOM tracking, manual review \u2705 Implemented Credential theft Non-root user, no credential storage \u2705 Implemented Host resource exhaustion Standard container limits (configurable) \u26a0\ufe0f User responsibility Malicious container images Cosign keyless signing \u2705 Implemented"},{"location":"security-overview/#out-of-scope","title":"Out of Scope","text":"<p>The following are explicitly not in scope for UBI's threat model:</p> <ul> <li>Physical security of the host machine</li> <li>Network security outside the container (firewall rules, etc.)</li> <li>Application security in projects built on UBI</li> <li>Secrets management (use dedicated tools like HashiCorp Vault)</li> </ul>"},{"location":"security-overview/#container-security","title":"Container Security","text":""},{"location":"security-overview/#no-privileged-mode","title":"No Privileged Mode","text":"<p>Status: \u2705 Removed and verified unnecessary</p> <p>UBI does not require or use privileged mode (<code>privileged: true</code>). This provides:</p> <ul> <li>Standard container isolation maintained</li> <li>Limited kernel capabilities (only required ones)</li> <li>AppArmor/SELinux profiles enforced</li> <li>Reduced attack surface</li> <li>Better compliance with security standards</li> </ul> <p>Details: See Privileged Mode Analysis for the full investigation and decision rationale.</p>"},{"location":"security-overview/#non-root-user","title":"Non-Root User","text":"<p>UBI runs as the <code>vscode</code> user by default, not root:</p> <pre><code>USER vscode\n</code></pre> <p>Benefits:</p> <ul> <li>Limits damage from container escape</li> <li>Prevents accidental system modifications</li> <li>Follows best practice for development containers</li> </ul> <p>Note: Some operations during image build require root, but the final runtime user is <code>vscode</code>.</p>"},{"location":"security-overview/#minimal-base-image","title":"Minimal Base Image","text":"<p>UBI uses Microsoft's DevContainers base image, which:</p> <ul> <li>Is actively maintained by Microsoft</li> <li>Receives regular security updates</li> <li>Has a small attack surface</li> <li>Is widely used and audited</li> </ul>"},{"location":"security-overview/#security-context","title":"Security Context","text":"<p>When running UBI, consider applying these Docker security options:</p> <pre><code># In docker-compose.yml\nservices:\n  development:\n    security_opt:\n      - no-new-privileges:true  # Prevent privilege escalation\n    cap_drop:\n      - ALL                     # Drop all capabilities\n    cap_add:\n      - NET_BIND_SERVICE       # Add back only what's needed\n</code></pre> <p>Note: UBI doesn't enforce these by default to maintain flexibility, but they're recommended for production-like environments.</p>"},{"location":"security-overview/#vulnerability-scanning","title":"Vulnerability Scanning","text":"<p>UBI uses Trivy for automated container vulnerability scanning.</p>"},{"location":"security-overview/#what-trivy-scans","title":"What Trivy Scans","text":"<ul> <li>OS packages: Debian packages from base image</li> <li>Application dependencies: Any installed libraries</li> <li>Known CVEs: Cross-references with vulnerability databases</li> <li>Misconfigurations: Docker and Kubernetes security issues</li> </ul>"},{"location":"security-overview/#when-scanning-occurs","title":"When Scanning Occurs","text":"Trigger Schedule Purpose Pull Requests On every PR Catch vulnerabilities before merge Push to main After each merge Verify security post-merge Weekly Schedule Monday 00:00 UTC Continuous monitoring for new CVEs Manual Dispatch On-demand Ad-hoc security checks"},{"location":"security-overview/#severity-levels","title":"Severity Levels","text":"<p>Trivy categorizes vulnerabilities by severity:</p> Severity Action Build Impact CRITICAL Fix immediately \u274c Fails build HIGH Fix within 30 days \u274c Fails build MEDIUM Fix within 90 days \u26a0\ufe0f Warning only LOW Fix when convenient \u2139\ufe0f Informational NEGLIGIBLE No action needed \u2139\ufe0f Informational <p>Build Policy: CI/CD pipeline fails if CRITICAL or HIGH severity vulnerabilities are detected.</p>"},{"location":"security-overview/#viewing-scan-results","title":"Viewing Scan Results","text":"<ol> <li>GitHub Security Tab:</li> <li>Navigate to: https://github.com/egohygiene/ubi/security/code-scanning</li> <li>View all detected vulnerabilities</li> <li> <p>Filter by severity, status, and date</p> </li> <li> <p>Workflow Artifacts:</p> </li> <li>Go to: https://github.com/egohygiene/ubi/actions/workflows/trivy-scan.yml</li> <li> <p>Download detailed report from artifact</p> </li> <li> <p>Pull Request Comments:</p> </li> <li>Trivy automatically comments on PRs with findings</li> </ol>"},{"location":"security-overview/#running-trivy-locally","title":"Running Trivy Locally","text":"<pre><code># Install Trivy\nbrew install trivy  # macOS\n# or\nwget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -\necho \"deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main\" | sudo tee /etc/apt/sources.list.d/trivy.list\nsudo apt-get update &amp;&amp; sudo apt-get install trivy\n\n# Scan UBI image\ntrivy image --severity CRITICAL,HIGH ghcr.io/egohygiene/ubi:latest\n\n# Generate report\ntrivy image --format json --output trivy-report.json ghcr.io/egohygiene/ubi:latest\n</code></pre>"},{"location":"security-overview/#addressing-vulnerabilities","title":"Addressing Vulnerabilities","text":"<p>When Trivy detects vulnerabilities:</p> <ol> <li>Assess Impact:</li> <li>Is the vulnerable package actually used in UBI?</li> <li>Is there an exploit available?</li> <li> <p>What's the attack vector?</p> </li> <li> <p>Determine Remediation:</p> </li> <li>Update base image: Check if newer version has fix</li> <li>Update packages: <code>apt-get upgrade</code> specific packages</li> <li>Remove package: If not needed, remove it</li> <li> <p>Accept risk: Document why and track for future fix</p> </li> <li> <p>Verify Fix:</p> </li> </ol> <pre><code># Rebuild and rescan\ndocker build -f .devcontainer/Dockerfile -t ubi:test .\ntrivy image --severity CRITICAL,HIGH ubi:test\n</code></pre> <ol> <li>Document:</li> <li>Update CHANGELOG.md with security fixes</li> <li>Bump version appropriately (PATCH for security fixes)</li> <li>Reference CVE IDs in commit messages</li> </ol>"},{"location":"security-overview/#software-bill-of-materials-sbom","title":"Software Bill of Materials (SBOM)","text":"<p>UBI generates an SBOM for every published image, providing full transparency into components.</p>"},{"location":"security-overview/#whats-in-the-sbom","title":"What's in the SBOM?","text":"<ul> <li>Package inventory: All installed packages with versions</li> <li>Dependencies: Transitive dependency graph</li> <li>Licenses: Open source license information</li> <li>Relationships: How components relate to each other</li> <li>Metadata: Build information, timestamps, checksums</li> </ul>"},{"location":"security-overview/#sbom-format","title":"SBOM Format","text":"<ul> <li>Standard: SPDX 2.3 (Software Package Data Exchange)</li> <li>Format: JSON (machine-readable)</li> <li>Tool: Syft by Anchore</li> </ul>"},{"location":"security-overview/#accessing-sboms","title":"Accessing SBOMs","text":"<p>SBOMs are generated for each UBI variant during the publish workflow and are available in multiple ways:</p>"},{"location":"security-overview/#1-github-release-assets","title":"1. GitHub Release Assets","text":"<p>Download pre-generated SBOMs from any release:</p> <pre><code># Set your desired version\nVERSION=\"0.1.5\"\n\n# Download SBOM for base variant\ncurl -L -O \"https://github.com/egohygiene/ubi/releases/download/${VERSION}/ubi-base-sbom-${VERSION}.spdx.json\"\n\n# Download SBOM for python variant\ncurl -L -O \"https://github.com/egohygiene/ubi/releases/download/${VERSION}/ubi-python-sbom-${VERSION}.spdx.json\"\n\n# Download SBOM for node variant\ncurl -L -O \"https://github.com/egohygiene/ubi/releases/download/${VERSION}/ubi-node-sbom-${VERSION}.spdx.json\"\n\n# Download SBOM for full variant\ncurl -L -O \"https://github.com/egohygiene/ubi/releases/download/${VERSION}/ubi-full-sbom-${VERSION}.spdx.json\"\n\n# Download SBOM for minimal variant\ncurl -L -O \"https://github.com/egohygiene/ubi/releases/download/${VERSION}/ubi-minimal-sbom-${VERSION}.spdx.json\"\n</code></pre> <p>Benefits: - \u2705 Pre-generated at build time (no need to generate locally) - \u2705 Permanently archived with each release - \u2705 Cryptographically tied to image digest - \u2705 Supports compliance and audit requirements</p>"},{"location":"security-overview/#2-github-workflow-artifacts","title":"2. GitHub Workflow Artifacts","text":"<p>Download from workflow runs (90-day retention): - Navigate to: https://github.com/egohygiene/ubi/actions/workflows/publish.yml - Select a workflow run - Download artifacts: <code>ubi-{variant}-sbom-{version}</code></p>"},{"location":"security-overview/#3-generate-locally","title":"3. Generate Locally","text":"<p>Generate SBOMs on-demand for any variant:</p> <pre><code># Install Syft\nbrew install syft\n\n# Set your desired version\nVERSION=\"0.1.5\"\n\n# Generate SBOM for base variant\nsyft \"ghcr.io/egohygiene/ubi:${VERSION}\" -o spdx-json &gt; \"ubi-base-sbom-${VERSION}.json\"\n\n# Generate SBOM for python variant\nsyft \"ghcr.io/egohygiene/ubi:${VERSION}-python\" -o spdx-json &gt; \"ubi-python-sbom-${VERSION}.json\"\n\n# View summary (table format)\nsyft \"ghcr.io/egohygiene/ubi:${VERSION}\" -o table\n\n# Generate in CycloneDX format (alternative to SPDX)\nsyft \"ghcr.io/egohygiene/ubi:${VERSION}\" -o cyclonedx-json &gt; \"ubi-base-sbom-${VERSION}.cyclonedx.json\"\n</code></pre>"},{"location":"security-overview/#sbom-use-cases","title":"SBOM Use Cases","text":"<ul> <li>Vulnerability Tracking: Cross-reference with CVE databases</li> <li>License Compliance: Identify all OSS licenses</li> <li>Supply Chain Risk: Audit third-party components</li> <li>Regulatory Compliance: Meet NTIA minimum elements</li> <li>Incident Response: Quickly identify affected components</li> </ul>"},{"location":"security-overview/#verifying-and-consuming-sboms","title":"Verifying and Consuming SBOMs","text":""},{"location":"security-overview/#validate-sbom-structure","title":"Validate SBOM Structure","text":"<pre><code># Install SPDX tools\npip install spdx-tools\n\n# Set your version\nVERSION=\"0.1.5\"\n\n# Validate SBOM structure\npyspdxtools -i \"ubi-base-sbom-${VERSION}.spdx.json\"\n\n# Extract package list\njq '.packages[] | .name' \"ubi-base-sbom-${VERSION}.spdx.json\"\n</code></pre>"},{"location":"security-overview/#scan-sbom-for-vulnerabilities","title":"Scan SBOM for Vulnerabilities","text":"<pre><code># Set your version\nVERSION=\"0.1.5\"\n\n# Use Grype to scan SBOM for vulnerabilities\ngrype \"sbom:./ubi-base-sbom-${VERSION}.spdx.json\"\n\n# Use Trivy to scan SBOM\ntrivy sbom \"ubi-base-sbom-${VERSION}.spdx.json\" --severity HIGH,CRITICAL\n</code></pre>"},{"location":"security-overview/#compare-variants","title":"Compare Variants","text":"<pre><code># Set your version\nVERSION=\"0.1.5\"\n\n# Compare package counts between variants\necho \"Base packages: $(jq '.packages | length' \"ubi-base-sbom-${VERSION}.spdx.json\")\"\necho \"Python packages: $(jq '.packages | length' \"ubi-python-sbom-${VERSION}.spdx.json\")\"\necho \"Full packages: $(jq '.packages | length' \"ubi-full-sbom-${VERSION}.spdx.json\")\"\n\n# Find packages unique to python variant\ncomm -13 \\\n  &lt;(jq -r '.packages[].name' \"ubi-base-sbom-${VERSION}.spdx.json\" | sort) \\\n  &lt;(jq -r '.packages[].name' \"ubi-python-sbom-${VERSION}.spdx.json\" | sort)\n</code></pre>"},{"location":"security-overview/#integrate-with-cicd","title":"Integrate with CI/CD","text":"<pre><code># Example GitHub Action to verify SBOM in downstream projects\n- name: Download and verify UBI SBOM\n  run: |\n    VERSION=\"0.1.5\"\n    curl -L -O \"https://github.com/egohygiene/ubi/releases/download/${VERSION}/ubi-base-sbom-${VERSION}.spdx.json\"\n\n    # Scan for vulnerabilities\n    grype sbom:./ubi-base-sbom-${VERSION}.spdx.json --fail-on high\n</code></pre>"},{"location":"security-overview/#sbom-best-practices","title":"SBOM Best Practices","text":"<ol> <li>Pin Specific Versions: Use version-specific SBOMs, not <code>latest</code></li> <li>Archive SBOMs: Store with your own release artifacts alongside derived images</li> <li>Regular Review: Periodically audit components in your base image</li> <li>Automate Checks: Integrate SBOM vulnerability scanning into CI/CD</li> <li>Variant Selection: Choose the minimal variant needed to reduce supply chain risk</li> <li>Share with Consumers: Make SBOMs available to your downstream users</li> <li>Track Changes: Monitor SBOM differences between versions to understand what changed</li> </ol>"},{"location":"security-overview/#supply-chain-security","title":"Supply Chain Security","text":"<p>UBI implements multiple supply chain security measures:</p>"},{"location":"security-overview/#1-dependency-review","title":"1. Dependency Review","text":"<p>Status: \u2705 Implemented</p> <p>GitHub's Dependency Review Action automatically analyzes dependency changes in all pull requests:</p> <ul> <li>What it checks: npm (package.json, package-lock.json) and Python (pyproject.toml) dependencies</li> <li>When it runs: On every pull request to main/master branches</li> <li>Scans for:</li> <li>Security vulnerabilities (CVEs from GitHub Advisory Database)</li> <li>License compatibility issues (denies GPL/AGPL)</li> <li>Deprecated or withdrawn packages</li> <li>Potentially malicious packages</li> <li>Build Policy: Fails CI/CD if HIGH or CRITICAL vulnerabilities are introduced</li> <li>Results: Comments directly on PRs with detailed findings and severity information</li> </ul> <p>View workflow: Dependency Review Workflow</p> <p>Benefits:</p> <ul> <li>\u2705 Prevents vulnerable dependencies from being merged</li> <li>\u2705 Enforces license compliance automatically</li> <li>\u2705 Provides immediate feedback in pull requests</li> <li>\u2705 Strengthens supply chain security posture</li> <li>\u2705 Detects malicious or compromised packages</li> </ul>"},{"location":"security-overview/#2-base-image-pinning","title":"2. Base Image Pinning","text":"<p>The base image is pinned with a cryptographic digest:</p> <pre><code>FROM mcr.microsoft.com/devcontainers/base:2.1.2@sha256:36751f1ee2f30745a649afc2b2061f321bacdaa0617159901fe6725b34c93df4\n</code></pre> <p>Benefits:</p> <ul> <li>\u2705 Immutable - same digest always pulls identical image</li> <li>\u2705 Tamper-proof - digest changes if image modified</li> <li>\u2705 Reproducible - builds are deterministic</li> <li>\u2705 Auditable - exact version is traceable</li> </ul> <p>Risks Mitigated:</p> <ul> <li>Tag hijacking (someone overwrites <code>:2.1.2</code> tag)</li> <li>Man-in-the-middle attacks during pull</li> <li>Accidental upstream changes</li> </ul>"},{"location":"security-overview/#3-dependency-tracking","title":"3. Dependency Tracking","text":"<p>All dependencies are tracked via:</p> <ul> <li>SBOM generation (Syft)</li> <li>Vulnerability scanning (Trivy)</li> <li>Dependency Review Action (for changes in PRs)</li> <li>Version pinning in Dockerfile (where applicable)</li> </ul>"},{"location":"security-overview/#4-secure-build-pipeline","title":"4. Secure Build Pipeline","text":"<p>GitHub Actions workflows use:</p> <ul> <li>Pinned action versions (e.g., <code>actions/checkout@v4</code>)</li> <li>Minimal permissions (principle of least privilege)</li> <li>Secrets management via GitHub Secrets</li> <li>Isolated build environments</li> </ul>"},{"location":"security-overview/#5-reproducible-builds","title":"5. Reproducible Builds","text":"<p>Every build is reproducible via:</p> <ul> <li>Git commit SHA tags (<code>sha-abc123</code>)</li> <li>Pinned base image digest</li> <li>Locked dependency versions</li> <li>Documented build process</li> </ul>"},{"location":"security-overview/#6-image-signing-with-cosign","title":"6. Image Signing with Cosign","text":"<p>Status: \u2705 Implemented</p> <p>UBI images are cryptographically signed using Sigstore Cosign with keyless signing:</p> <pre><code># Verify signed image\ncosign verify \\\n  --certificate-identity-regexp=\"https://github.com/egohygiene/ubi/\" \\\n  --certificate-oidc-issuer=\"https://token.actions.githubusercontent.com\" \\\n  ghcr.io/egohygiene/ubi:latest\n</code></pre> <p>Benefits:</p> <ul> <li>\u2705 Cryptographic proof of authenticity</li> <li>\u2705 Verification of image provenance</li> <li>\u2705 Protection against supply chain attacks</li> <li>\u2705 Keyless signing via GitHub OIDC (no key management)</li> <li>\u2705 Transparency log backed by Sigstore Rekor</li> <li>\u2705 Traceable to specific GitHub workflow runs</li> </ul> <p>How It Works:</p> <ol> <li>GitHub Actions workflow builds and pushes the image</li> <li>Cosign signs the image digest using GitHub OIDC identity</li> <li>Signature is stored in the container registry alongside the image</li> <li>Signature is recorded in Sigstore's public transparency log</li> <li>Anyone can verify the signature without needing access to private keys</li> </ol> <p>What Gets Signed:</p> <ul> <li>All published tags (<code>latest</code>, version tags, SHA tags)</li> <li>Signed by digest, so signature covers all architectures (amd64, arm64)</li> <li>Signature metadata includes workflow identity and build context</li> </ul> <p>Verification Example:</p> <pre><code># Install Cosign\nbrew install cosign  # macOS\n# or download from https://github.com/sigstore/cosign/releases\n\n# Verify latest image\ncosign verify \\\n  --certificate-identity-regexp=\"https://github.com/egohygiene/ubi/\" \\\n  --certificate-oidc-issuer=\"https://token.actions.githubusercontent.com\" \\\n  ghcr.io/egohygiene/ubi:latest\n\n# Verify specific version\ncosign verify \\\n  --certificate-identity-regexp=\"https://github.com/egohygiene/ubi/\" \\\n  --certificate-oidc-issuer=\"https://token.actions.githubusercontent.com\" \\\n  ghcr.io/egohygiene/ubi:0.1.5\n</code></pre>"},{"location":"security-overview/#7-slsa-build-provenance-attestation","title":"7. SLSA Build Provenance Attestation","text":"<p>Status: \u2705 Implemented</p> <p>UBI generates SLSA build provenance attestations for every published image:</p> <ul> <li>SLSA Level: Level 2+ compliance</li> <li>Attestation Format: In-toto SLSA Provenance (v1.0)</li> <li>Generation: GitHub Actions <code>actions/attest-build-provenance@v2</code></li> <li>Storage: GitHub attestation registry and GHCR</li> <li>Coverage: All image variants (base, minimal, python, node, full)</li> </ul> <p>How It Works:</p> <p>Each image variant (base, minimal, python, node, full) is built separately with its own Dockerfile and receives its own unique attestation. The attestation is cryptographically linked to the image digest, so any tag pointing to that digest can be verified.</p> <p>What's Included:</p> <ul> <li>Build environment metadata (GitHub Actions runner details)</li> <li>Source repository and commit SHA</li> <li>Workflow identity and build parameters</li> <li>Image digest and subject information</li> <li>Cryptographic signature via Sigstore</li> </ul> <p>Verification:</p> <pre><code># Install GitHub CLI\nbrew install gh  # macOS\n# or follow instructions at https://cli.github.com/\n\n# Verify attestation for base image (latest)\ngh attestation verify oci://ghcr.io/egohygiene/ubi:latest --owner egohygiene\n\n# Verify attestation for a specific variant\ngh attestation verify oci://ghcr.io/egohygiene/ubi:latest-python --owner egohygiene\ngh attestation verify oci://ghcr.io/egohygiene/ubi:0.1.5-node --owner egohygiene\n\n# View full attestation details in JSON\ngh attestation verify oci://ghcr.io/egohygiene/ubi:latest --owner egohygiene --format json | jq\n</code></pre> <p>Benefits:</p> <ul> <li>\u2705 Verifiable build provenance for supply chain security</li> <li>\u2705 Proof that images were built by authorized GitHub workflows</li> <li>\u2705 Tamper-proof cryptographic link between source and artifact</li> <li>\u2705 Compliance with SLSA framework requirements</li> <li>\u2705 Enhanced transparency for downstream consumers</li> </ul>"},{"location":"security-overview/#future-enhancements","title":"Future Enhancements","text":""},{"location":"security-overview/#security-policy-as-code","title":"Security Policy as Code","text":"<p>Status: \ud83d\udd2e Under consideration</p> <p>Implement OPA (Open Policy Agent) policies:</p> <ul> <li>Enforce security best practices in CI</li> <li>Policy-based vulnerability acceptance</li> <li>Automated compliance checking</li> </ul>"},{"location":"security-overview/#security-best-practices-for-ubi-users","title":"Security Best Practices for UBI Users","text":"<p>When using UBI in your projects:</p> <ol> <li>Pin Specific Versions: Use version tags, not <code>latest</code></li> </ol> <pre><code>{\n  \"image\": \"ghcr.io/egohygiene/ubi:0.1.5\"\n}\n</code></pre> <ol> <li> <p>Review SBOMs: Understand what's in your base image</p> </li> <li> <p>Monitor Security Advisories: Subscribe to repository notifications</p> </li> <li> <p>Keep Updated: Regularly update to latest patched versions</p> </li> <li> <p>Scan Your Images: Run Trivy on your derived images</p> </li> </ol> <pre><code>trivy image your-image:tag\n</code></pre> <ol> <li> <p>Don't Store Secrets: Never commit credentials to images</p> </li> <li> <p>Use Security Context: Apply appropriate Docker security options</p> </li> <li> <p>Limit Resources: Set memory and CPU limits</p> </li> </ol> <pre><code>services:\n  dev:\n    mem_limit: 4g\n    cpus: '2.0'\n</code></pre>"},{"location":"security-overview/#reporting-vulnerabilities","title":"Reporting Vulnerabilities","text":""},{"location":"security-overview/#security-policy","title":"Security Policy","text":"<p>For details on reporting security vulnerabilities, see SECURITY.md.</p>"},{"location":"security-overview/#what-to-report","title":"What to Report","text":"<ul> <li>Security vulnerabilities in UBI</li> <li>Misconfigurations in Dockerfile or workflows</li> <li>Supply chain concerns</li> <li>Privilege escalation vectors</li> <li>Any security-relevant issues</li> </ul>"},{"location":"security-overview/#what-not-to-report","title":"What Not to Report","text":"<ul> <li>Vulnerabilities in base image (report to Microsoft)</li> <li>Application-level issues in your projects</li> <li>Generic Docker security questions</li> </ul>"},{"location":"security-overview/#disclosure-process","title":"Disclosure Process","text":"<ol> <li>Private Disclosure: Email security contact (see SECURITY.md)</li> <li>Assessment: We evaluate severity and impact</li> <li>Fix Development: Patch created and tested</li> <li>Coordinated Release: Fix released with security advisory</li> <li>Public Disclosure: Vulnerability disclosed after fix available</li> </ol>"},{"location":"security-overview/#response-sla","title":"Response SLA","text":"Severity Initial Response Fix Target Critical 24 hours 7 days High 48 hours 30 days Medium 5 days 90 days Low 10 days Best effort"},{"location":"security-overview/#security-resources","title":"Security Resources","text":""},{"location":"security-overview/#internal-documentation","title":"Internal Documentation","text":"<ul> <li>Privileged Mode Analysis</li> <li>Architecture Overview</li> <li>Release Process</li> <li>Main Security Policy</li> </ul>"},{"location":"security-overview/#external-resources","title":"External Resources","text":"<ul> <li>Docker Security Best Practices</li> <li>CIS Docker Benchmark</li> <li>OWASP Container Security</li> <li>NIST Container Security Guide</li> <li>Trivy Documentation</li> <li>SBOM Minimum Elements (NTIA)</li> <li>SLSA Framework - Supply-chain Levels for Software Artifacts</li> <li>GitHub Attestations - Build provenance documentation</li> </ul>"},{"location":"security-overview/#tools","title":"Tools","text":"<ul> <li>Trivy - Vulnerability scanner</li> <li>Syft - SBOM generator</li> <li>Cosign - Container image signing</li> <li>GitHub CLI - Attestation verification</li> <li>Docker Bench Security - Security audit tool</li> </ul>"},{"location":"security-overview/#security-changelog","title":"Security Changelog","text":"<p>Track security-related changes in UBI:</p>"},{"location":"security-overview/#v015-2025-12-11","title":"v0.1.5 (2025-12-11)","text":"<ul> <li>Initial security documentation created</li> <li>Trivy scanning workflow established</li> <li>SBOM generation implemented in publish workflow</li> </ul>"},{"location":"security-overview/#v014-2025-12-11","title":"v0.1.4 (2025-12-11)","text":"<ul> <li>Version synchronization fixes (no security changes)</li> </ul>"},{"location":"security-overview/#v013-2025-12-11","title":"v0.1.3 (2025-12-11)","text":"<ul> <li>Removed privileged mode from devcontainer</li> <li>Enhanced container isolation</li> <li>Documented security decision in privileged-mode.md</li> </ul> <p>Last Updated: 2025-12-13 Next Review: Quarterly or when significant changes occur Maintained By: Ego Hygiene Security Team</p>"},{"location":"source-of-truth/","title":"Documentation Source of Truth Guidelines","text":"<p>This document defines the canonical locations for all documentation in the UBI repository to prevent drift and duplication.</p>"},{"location":"source-of-truth/#canonical-documentation-locations","title":"Canonical Documentation Locations","text":""},{"location":"source-of-truth/#core-project-files","title":"Core Project Files","text":"<p>These files are the single source of truth and must never be duplicated:</p> Document Location Purpose Automated? CHANGELOG <code>/CHANGELOG.md</code> Version history and release notes \u2705 Yes (bump-my-version) LICENSE <code>/LICENSE</code> MIT License full text \u274c No README <code>/README.md</code> Project overview and quick start \u274c No VERSION <code>/VERSION</code> Current semantic version \u2705 Yes (bump-my-version) CONTRIBUTING <code>/CONTRIBUTING.md</code> Contribution guidelines \u274c No SECURITY <code>/SECURITY.md</code> Security policy and reporting \u274c No"},{"location":"source-of-truth/#documentation-site-files","title":"Documentation Site Files","text":"<p>Documentation in the <code>docs/</code> directory may reference canonical files but should not duplicate their content:</p> Document Location Type References Changelog <code>/docs/changelog.md</code> Reference page \u2192 <code>/CHANGELOG.md</code> License <code>/docs/license.md</code> Reference page \u2192 <code>/LICENSE</code> Index <code>/docs/index.md</code> Landing page Multiple Architecture <code>/docs/architecture.md</code> Standalone N/A Troubleshooting <code>/docs/troubleshooting.md</code> Standalone N/A"},{"location":"source-of-truth/#why-this-matters","title":"Why This Matters","text":""},{"location":"source-of-truth/#problems-with-duplication","title":"Problems with Duplication","text":"<ol> <li>Content Drift: Duplicated files inevitably diverge over time</li> <li>Confusion: Contributors don't know which file to edit</li> <li>Maintenance Burden: Multiple files need updates for single changes</li> <li>Automation Conflicts: Automated tools (like bump-my-version) can't update duplicates</li> <li>Inconsistency: Users see different information depending on where they look</li> </ol>"},{"location":"source-of-truth/#our-solution","title":"Our Solution","text":"<ul> <li>One canonical source for each piece of information</li> <li>Reference pages that link to canonical sources (not copy content)</li> <li>Clear documentation about where each file lives</li> <li>Automation-friendly structure that tools can reliably update</li> </ul>"},{"location":"source-of-truth/#guidelines-for-contributors","title":"Guidelines for Contributors","text":""},{"location":"source-of-truth/#when-adding-new-documentation","title":"When Adding New Documentation","text":"<ol> <li>Check if it exists: Search for existing documentation on the topic</li> <li>Choose the right location:</li> <li>Root-level files (e.g., <code>README.md</code>) for essential project info</li> <li><code>docs/</code> directory for detailed guides and references</li> <li>Avoid duplication: Link to existing content rather than copying</li> <li>Update navigation: Add new docs to <code>mkdocs.yml</code> if needed</li> </ol>"},{"location":"source-of-truth/#when-updating-documentation","title":"When Updating Documentation","text":"<ol> <li>Find the canonical source: Check this guide for the authoritative location</li> <li>Edit only the canonical file: Never edit reference/pointer pages</li> <li>Update references if needed: If you change structure, update links</li> <li>Test your changes: Build docs locally with <code>mkdocs serve</code></li> </ol>"},{"location":"source-of-truth/#when-referencing-canonical-files","title":"When Referencing Canonical Files","text":"<p>Use clear language to indicate you're referencing, not duplicating:</p> <p>\u2705 Good - Clear Reference <pre><code>!!! info \"Canonical Source\"\n    For the complete changelog, see [CHANGELOG.md](../CHANGELOG.md)\n</code></pre></p> <p>\u274c Bad - Copying Content <pre><code>## Changelog\n\n### Version 0.1.5\n- Fixed version synchronization\n...\n</code></pre></p>"},{"location":"source-of-truth/#automated-documentation","title":"Automated Documentation","text":"<p>Some documentation is automatically generated or updated:</p>"},{"location":"source-of-truth/#bump-my-version","title":"bump-my-version","text":"<ul> <li>Updates: <code>/CHANGELOG.md</code> and <code>/VERSION</code></li> <li>Configuration: <code>pyproject.toml</code> ([tool.bumpversion] section)</li> <li>Trigger: Manual bump or GitHub Actions workflow</li> <li>\u26a0\ufe0f Never manually edit: These files during version bumps</li> </ul>"},{"location":"source-of-truth/#mkdocs-build","title":"MkDocs Build","text":"<ul> <li>Generates: Static site from <code>docs/</code> directory</li> <li>Configuration: <code>mkdocs.yml</code></li> <li>Output: <code>site/</code> directory (not committed)</li> <li>Deployment: GitHub Actions to GitHub Pages</li> </ul>"},{"location":"source-of-truth/#file-organization-principles","title":"File Organization Principles","text":""},{"location":"source-of-truth/#root-directory","title":"Root Directory","text":"<p>Files in the root directory should be:</p> <ul> <li>Essential project metadata (README, LICENSE, etc.)</li> <li>Version control files (.gitignore, .editorconfig)</li> <li>Build configuration (Dockerfile, pyproject.toml, etc.)</li> <li>CI/CD configuration (.github/)</li> </ul> <p>Keep it minimal - move detailed docs to <code>docs/</code></p>"},{"location":"source-of-truth/#docs-directory","title":"Docs Directory","text":"<p>Files in <code>docs/</code> should be:</p> <ul> <li>Detailed guides and tutorials</li> <li>Architecture and design documentation</li> <li>Reference material</li> <li>Contributing and development guides</li> </ul> <p>Organize by topic - use subdirectories for related content</p>"},{"location":"source-of-truth/#checking-for-duplicates","title":"Checking for Duplicates","text":""},{"location":"source-of-truth/#manual-check","title":"Manual Check","text":"<p>Periodically search for potential duplicates:</p> <pre><code># Find files with similar names\nfind . -name \"*changelog*\" -o -name \"*license*\" -o -name \"*readme*\"\n\n# Search for duplicated content\ngrep -r \"specific unique phrase\" .\n</code></pre>"},{"location":"source-of-truth/#automated-audits","title":"Automated Audits","text":"<p>The repository includes audit scripts that check for:</p> <ul> <li>Duplicate file names</li> <li>Inconsistent version numbers</li> <li>Broken documentation links</li> <li>Missing source of truth references</li> </ul> <p>See <code>audit/</code> directory for reports and scripts.</p>"},{"location":"source-of-truth/#common-scenarios","title":"Common Scenarios","text":""},{"location":"source-of-truth/#scenario-i-want-to-add-a-new-feature-to-the-changelog","title":"Scenario: I want to add a new feature to the changelog","text":"<p>Answer: You don't! The changelog is automatically updated by bump-my-version. Instead:</p> <ol> <li>Make your changes</li> <li>Create a PR with good description</li> <li>Use bump-my-version to create a new version</li> <li>The changelog is updated automatically</li> </ol>"},{"location":"source-of-truth/#scenario-i-want-to-update-the-license","title":"Scenario: I want to update the license","text":"<p>Answer: Edit <code>/LICENSE</code> in the root directory. The docs reference page will automatically link to the updated version.</p>"},{"location":"source-of-truth/#scenario-i-want-to-add-documentation-about-a-new-feature","title":"Scenario: I want to add documentation about a new feature","text":"<p>Answer:  1. Create a new file in <code>docs/</code> (e.g., <code>docs/new-feature.md</code>) 2. Add it to <code>mkdocs.yml</code> navigation 3. Link to it from relevant places (README, index.md, etc.) 4. Do NOT duplicate information already in other docs</p>"},{"location":"source-of-truth/#scenario-i-found-duplicated-content","title":"Scenario: I found duplicated content","text":"<p>Answer: 1. Identify the canonical source (use this guide) 2. Replace duplicates with references/links 3. Update any navigation or links 4. Submit a PR with the consolidation</p>"},{"location":"source-of-truth/#version-history","title":"Version History","text":"<ul> <li>Initial version: Created during documentation consolidation effort</li> <li>See CHANGELOG.md for project version history</li> </ul>"},{"location":"source-of-truth/#related-documentation","title":"Related Documentation","text":"<ul> <li>Contributing Guide - How to contribute to UBI</li> <li>Release Process - How versions and releases work</li> <li>Architecture - Overall project structure and design</li> </ul> <p>Remember: When in doubt, link to the canonical source rather than copying content. This keeps our documentation maintainable and trustworthy.</p>"},{"location":"troubleshooting/","title":"Troubleshooting Guide","text":"<p>This guide covers common issues you may encounter when working with UBI and their solutions.</p>"},{"location":"troubleshooting/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Devcontainer Build Issues</li> <li>Docker Layer Caching</li> <li>Version Bump Issues</li> <li>CHANGELOG Problems</li> <li>Environment Variable Issues</li> <li>Image Pull Failures</li> <li>Permission Problems</li> </ul>"},{"location":"troubleshooting/#devcontainer-build-issues","title":"Devcontainer Build Issues","text":""},{"location":"troubleshooting/#issue-devcontainer-fails-to-build-with-base-image-not-found","title":"Issue: Devcontainer fails to build with \"base image not found\"","text":"<p>Symptoms:</p> <pre><code>Error response from daemon: manifest for mcr.microsoft.com/devcontainers/base:2.1.2@sha256:... not found\n</code></pre> <p>Causes:</p> <ul> <li>Base image digest may have been updated or removed upstream</li> <li>Network connectivity issues to Microsoft Container Registry</li> <li>Docker daemon cache issues</li> </ul> <p>Solutions:</p> <ol> <li>Verify base image availability:</li> </ol> <pre><code>docker pull mcr.microsoft.com/devcontainers/base:2.1.2\n</code></pre> <ol> <li>Check the latest digest:</li> </ol> <pre><code>docker pull mcr.microsoft.com/devcontainers/base:2.1.2\ndocker inspect mcr.microsoft.com/devcontainers/base:2.1.2 \\\n  --format='{{index .RepoDigests 0}}'\n</code></pre> <ol> <li>Update Dockerfile if digest changed:</li> <li>Update <code>.devcontainer/Dockerfile</code> with new digest</li> <li> <p>See README.md for full instructions</p> </li> <li> <p>Clear Docker cache and rebuild:</p> </li> </ol> <pre><code>docker system prune -f\ndocker build -f .devcontainer/Dockerfile -t ubi:test . --no-cache\n</code></pre>"},{"location":"troubleshooting/#issue-permission-denied-errors-during-devcontainer-build","title":"Issue: \"Permission denied\" errors during devcontainer build","text":"<p>Symptoms:</p> <pre><code>mkdir: cannot create directory '/opt/universal/bin': Permission denied\n</code></pre> <p>Causes:</p> <ul> <li>Incorrect user context in Dockerfile</li> <li>Volume mount permission issues</li> <li>SELinux/AppArmor restrictions</li> </ul> <p>Solutions:</p> <ol> <li>Check Dockerfile USER directive:</li> </ol> <pre><code># Should run as root during build, then switch to vscode\nUSER root\nRUN mkdir -p /opt/universal/bin\nUSER vscode\n</code></pre> <ol> <li>For volume mount issues in docker-compose.yml:</li> </ol> <pre><code>volumes:\n  - ..:/workspace:cached  # Add :cached for better performance\n</code></pre> <ol> <li>On SELinux systems, relabel volumes:</li> </ol> <pre><code>volumes:\n  - ..:/workspace:z  # :z for shared, :Z for private\n</code></pre>"},{"location":"troubleshooting/#issue-devcontainer-builds-but-environment-is-incorrect","title":"Issue: Devcontainer builds but environment is incorrect","text":"<p>Symptoms:</p> <ul> <li>Environment variables not set</li> <li><code>/opt/universal</code> directories missing</li> <li>Wrong locale or timezone</li> </ul> <p>Solutions:</p> <ol> <li>Verify environment in running container:</li> </ol> <pre><code>docker exec -it &lt;container-name&gt; env | grep UNIVERSAL\ndocker exec -it &lt;container-name&gt; ls -la /opt/universal\n</code></pre> <ol> <li>Force rebuild without cache:</li> </ol> <pre><code># In VS Code: Cmd/Ctrl+Shift+P \u2192 \"Dev Containers: Rebuild Container\"\n# Or via CLI:\ndocker-compose -f .devcontainer/docker-compose.yml build --no-cache\n</code></pre> <ol> <li>Check for overridden environment variables:</li> <li>Review <code>.devcontainer/devcontainer.json</code> for conflicting <code>remoteEnv</code></li> <li>Check <code>.devcontainer/.env</code> file</li> <li>Verify <code>docker-compose.yml</code> doesn't override ENVs</li> </ol>"},{"location":"troubleshooting/#docker-layer-caching","title":"Docker Layer Caching","text":""},{"location":"troubleshooting/#issue-builds-are-slow-despite-no-changes","title":"Issue: Builds are slow despite no changes","text":"<p>Symptoms:</p> <ul> <li>Every build re-downloads packages</li> <li>Dockerfile changes invalidate all subsequent layers</li> <li>CI builds take excessive time</li> </ul> <p>Solutions:</p> <ol> <li>Optimize Dockerfile layer ordering:</li> <li>Put rarely-changing steps early (base image, system packages)</li> <li>Put frequently-changing steps late (application code)</li> <li> <p>Group related RUN commands to reduce layers</p> </li> <li> <p>Use Docker BuildKit for better caching:</p> </li> </ol> <pre><code>DOCKER_BUILDKIT=1 docker build -f .devcontainer/Dockerfile -t ubi:local .\n</code></pre> <ol> <li>Enable BuildKit cache mounts:</li> </ol> <pre><code>RUN --mount=type=cache,target=/var/cache/apt \\\n    apt-get update &amp;&amp; apt-get install -y package-name\n</code></pre> <ol> <li>In GitHub Actions, use caching:</li> </ol> <pre><code>- name: Set up Docker Buildx\n  uses: docker/setup-buildx-action@v3\n  with:\n    driver-opts: |\n      network=host\n      image=moby/buildkit:latest\n</code></pre>"},{"location":"troubleshooting/#issue-cache-not-being-used-in-ci","title":"Issue: Cache not being used in CI","text":"<p>Symptoms:</p> <ul> <li>CI builds from scratch every time</li> <li>Previous layers not reused</li> </ul> <p>Solutions:</p> <ol> <li>Verify GitHub Actions cache configuration:</li> </ol> <pre><code>- name: Build and Push\n  uses: docker/build-push-action@v5\n  with:\n    cache-from: type=gha\n    cache-to: type=gha,mode=max\n</code></pre> <ol> <li>Check layer order in Dockerfile:</li> <li>Ensure ARG declarations don't unnecessarily invalidate cache</li> <li>Use multi-stage builds to cache intermediate stages</li> </ol>"},{"location":"troubleshooting/#version-bump-issues","title":"Version Bump Issues","text":""},{"location":"troubleshooting/#issue-bump-my-version-command-fails","title":"Issue: <code>bump-my-version</code> command fails","text":"<p>Symptoms:</p> <pre><code>ERROR: Could not find a valid version string\nERROR: No files were modified\n</code></pre> <p>Causes:</p> <ul> <li><code>pyproject.toml</code> configuration mismatch</li> <li>VERSION file doesn't match current version in config</li> <li>Regex pattern doesn't match version format</li> </ul> <p>Solutions:</p> <ol> <li>Verify VERSION file content:</li> </ol> <pre><code>cat VERSION\n# Should contain only version number (e.g., 0.1.5) with newline\n</code></pre> <ol> <li>Check pyproject.toml configuration:</li> </ol> <pre><code>grep -A 5 \"\\[tool.bumpversion\\]\" pyproject.toml\n# Verify current_version matches VERSION file\n</code></pre> <ol> <li>Manually sync version numbers:</li> </ol> <pre><code># In pyproject.toml\n[tool.poetry]\nversion = \"0.1.5\"\n\n[tool.bumpversion]\ncurrent_version = \"0.1.5\"\n</code></pre> <ol> <li>Test version bump locally:</li> </ol> <pre><code>pip install bump-my-version\nbump-my-version patch --dry-run --verbose\n</code></pre>"},{"location":"troubleshooting/#issue-version-bump-succeeds-but-tag-not-created","title":"Issue: Version bump succeeds but tag not created","text":"<p>Symptoms:</p> <ul> <li>Commit created with new version</li> <li>Git tag not created</li> <li>CI publish workflow not triggered</li> </ul> <p>Causes:</p> <ul> <li><code>tag = false</code> in pyproject.toml (expected behavior)</li> <li>GitHub Actions workflow not pushing tags</li> <li>Permission issues in workflow</li> </ul> <p>Solutions:</p> <ol> <li>Verify workflow configuration in <code>bump-version.yml</code>:</li> </ol> <pre><code>- name: Push bump commit + tags\n  uses: ad-m/github-push-action@master\n  with:\n    github_token: ${{ secrets.GITHUB_TOKEN }}\n    branch: main\n    tags: true  # Ensure this is set\n</code></pre> <ol> <li>Check workflow permissions:</li> </ol> <pre><code>permissions:\n  contents: write  # Required for tag creation\n</code></pre> <ol> <li>Manually create tag if needed:</li> </ol> <pre><code>git tag 0.1.6\ngit push origin 0.1.6\n</code></pre>"},{"location":"troubleshooting/#changelog-problems","title":"CHANGELOG Problems","text":""},{"location":"troubleshooting/#issue-changelogmd-not-being-updated","title":"Issue: CHANGELOG.md not being updated","text":"<p>Symptoms:</p> <ul> <li>Version bumped but CHANGELOG unchanged</li> <li>CHANGELOG has duplicate entries</li> <li>Wrong format after bump</li> </ul> <p>Causes:</p> <ul> <li><code>pyproject.toml</code> CHANGELOG configuration incorrect</li> <li>Regex pattern not matching CHANGELOG format</li> <li>Manual edits broke the pattern matching</li> </ul> <p>Solutions:</p> <ol> <li>Verify CHANGELOG configuration in pyproject.toml:</li> </ol> <pre><code>[[tool.bumpversion.files]]\nfilename = \"CHANGELOG.md\"\nregex = true\nsearch = \"\\\\A## \"\nreplace = \"\"\"## {new_version} ({now:%Y-%m-%d})\n[Compare the full difference.](https://github.com/egohygiene/ubi/compare/{current_version}...{new_version})\n\n## \"\"\"\n</code></pre> <ol> <li>Check CHANGELOG.md format:</li> <li>First line after any markdown comments should be <code>## X.Y.Z (YYYY-MM-DD)</code></li> <li> <p>Pattern must match exactly</p> </li> <li> <p>Fix broken CHANGELOG:</p> </li> </ol> <pre><code># Ensure first version header starts at beginning of line\n# Example correct format:\n## {new_version} ({now:%Y-%m-%d})\n[Compare the full difference.](https://github.com/egohygiene/ubi/compare/{current_version}...{new_version})\n</code></pre> <ol> <li>Test CHANGELOG update:</li> </ol> <pre><code>bump-my-version patch --dry-run --verbose\n# Check output for CHANGELOG modifications\n</code></pre>"},{"location":"troubleshooting/#issue-changelog-has-merge-conflicts","title":"Issue: CHANGELOG has merge conflicts","text":"<p>Symptoms:</p> <ul> <li>Git merge conflicts in CHANGELOG.md</li> <li>Multiple version entries colliding</li> </ul> <p>Solutions:</p> <ol> <li>Resolve manually prioritizing chronological order:</li> </ol> <pre><code>## 0.1.6 (2025-12-13)\n[Compare...]\n\n## 0.1.5 (2025-12-11)\n[Compare...]\n</code></pre> <ol> <li>Keep newest version at top:</li> <li>Remove conflict markers</li> <li>Ensure versions are in descending order</li> <li>Preserve all unique entries</li> </ol>"},{"location":"troubleshooting/#environment-variable-issues","title":"Environment Variable Issues","text":""},{"location":"troubleshooting/#issue-xdg-directories-not-being-used-by-applications","title":"Issue: XDG directories not being used by applications","text":"<p>Symptoms:</p> <ul> <li>Applications still write to <code>~/.config</code></li> <li>Cache files in home directory</li> <li>XDG_* variables set but ignored</li> </ul> <p>Causes:</p> <ul> <li>Application doesn't support XDG</li> <li>Variables set but directories don't exist</li> <li>Permission issues on XDG directories</li> </ul> <p>Solutions:</p> <ol> <li>Verify directories exist and are writable:</li> </ol> <pre><code>ls -la /opt/universal/\ntouch /opt/universal/config/test &amp;&amp; rm /opt/universal/config/test\n</code></pre> <ol> <li>Check if application supports XDG:</li> </ol> <pre><code># Some apps need explicit configuration\n# Example for pip:\nmkdir -p $XDG_CONFIG_HOME/pip\necho \"[global]\" &gt; $XDG_CONFIG_HOME/pip/pip.conf\n</code></pre> <ol> <li>Set application-specific overrides:</li> </ol> <pre><code># Example for npm\nexport NPM_CONFIG_USERCONFIG=$XDG_CONFIG_HOME/npm/npmrc\n</code></pre>"},{"location":"troubleshooting/#image-pull-failures","title":"Image Pull Failures","text":""},{"location":"troubleshooting/#issue-cannot-pull-ubi-image-from-ghcr","title":"Issue: Cannot pull UBI image from GHCR","text":"<p>Symptoms:</p> <pre><code>Error response from daemon: unauthorized: authentication required\nError: ghcr.io/egohygiene/ubi:0.1.5 not found\n</code></pre> <p>Solutions:</p> <ol> <li>Authenticate to GitHub Container Registry:</li> </ol> <pre><code>echo $GITHUB_TOKEN | docker login ghcr.io -u USERNAME --password-stdin\n</code></pre> <ol> <li>Verify image exists:</li> </ol> <pre><code>curl -s \"https://ghcr.io/v2/egohygiene/ubi/tags/list\" | jq\n</code></pre> <ol> <li>Try with explicit tag:</li> </ol> <pre><code>docker pull ghcr.io/egohygiene/ubi:latest\ndocker pull ghcr.io/egohygiene/ubi:0.1.5\n</code></pre> <ol> <li>Check package visibility:</li> <li>Visit https://github.com/orgs/egohygiene/packages</li> <li>Ensure package is public or you have access</li> </ol>"},{"location":"troubleshooting/#permission-problems","title":"Permission Problems","text":""},{"location":"troubleshooting/#issue-cannot-write-to-optuniversal-directories","title":"Issue: Cannot write to /opt/universal directories","text":"<p>Symptoms:</p> <pre><code>touch: cannot touch '/opt/universal/cache/test': Permission denied\n</code></pre> <p>Solutions:</p> <ol> <li>Check directory ownership:</li> </ol> <pre><code>ls -la /opt/universal/\n# Should be owned by vscode:vscode\n</code></pre> <ol> <li>Fix permissions:</li> </ol> <pre><code># In Dockerfile:\nRUN chown -R vscode:vscode /opt/universal\n</code></pre> <ol> <li>Verify current user:</li> </ol> <pre><code>whoami  # Should be 'vscode'\nid      # Check groups\n</code></pre>"},{"location":"troubleshooting/#getting-help","title":"Getting Help","text":"<p>If you encounter issues not covered here:</p> <ol> <li>Check existing GitHub issues:</li> <li>Open Issues</li> <li> <p>Search for similar problems</p> </li> <li> <p>Review logs:</p> </li> <li>Docker build logs: <code>docker build ... 2&gt;&amp;1 | tee build.log</code></li> <li>Container logs: <code>docker logs &lt;container-name&gt;</code></li> <li> <p>GitHub Actions logs: Check workflow run details</p> </li> <li> <p>Open a new issue:</p> </li> <li>Use the issue template</li> <li>Include reproduction steps</li> <li>Attach relevant logs</li> <li> <p>Specify UBI version</p> </li> <li> <p>Useful debugging commands:</p> </li> </ol> <pre><code># Check container details\ndocker inspect &lt;container-name&gt;\n\n# Shell into running container\ndocker exec -it &lt;container-name&gt; bash\n\n# Check environment\ndocker exec &lt;container-name&gt; env | sort\n\n# Verify filesystem\ndocker exec &lt;container-name&gt; ls -laR /opt/universal\n</code></pre>"},{"location":"troubleshooting/#additional-resources","title":"Additional Resources","text":"<ul> <li>UBI Architecture Documentation</li> <li>Release Process Guide</li> <li>Security Overview</li> <li>Main README</li> <li>GitHub Discussions</li> </ul>"},{"location":"variants/","title":"UBI Variants","text":"<p>UBI provides multiple image variants optimized for different use cases. Each variant is built from the same base but includes different sets of tools and runtimes.</p>"},{"location":"variants/#available-variants","title":"Available Variants","text":""},{"location":"variants/#base-default","title":"\ud83d\udd39 Base (Default)","text":"<p>Image: <code>ghcr.io/egohygiene/ubi:latest</code> or <code>ghcr.io/egohygiene/ubi:0.1.5</code></p> <p>The original UBI image as defined in <code>.devcontainer/Dockerfile</code>. This is the default variant and provides a general-purpose development environment with all the foundational XDG directory structure and environment variables.</p> <p>Use this when: - You need the standard UBI experience - You're already using UBI and don't need specialized tooling - You want consistency with existing projects</p> <p>What's included: - XDG-compliant directory structure (<code>/opt/universal/*</code>) - Comprehensive environment variables for locale, colors, and tooling - Base devcontainer utilities - All telemetry disabled by default - Docker HEALTHCHECK validates bash availability</p>"},{"location":"variants/#minimal","title":"\ud83d\udd39 Minimal","text":"<p>Image: <code>ghcr.io/egohygiene/ubi:latest-minimal</code> or <code>ghcr.io/egohygiene/ubi:0.1.5-minimal</code></p> <p>The most lightweight variant with only foundational environment variables and XDG directory structure. No language runtimes, build tools, or package managers.</p> <p>Use this when: - You need the smallest possible image size - You want to add only specific tools you need - Security surface reduction is a priority - Building specialized containers with minimal dependencies</p> <p>What's included: - XDG-compliant directory structure (<code>/opt/universal/*</code>) - Essential environment variables (locale, colors, basic tooling) - Telemetry controls - Basic system utilities from the devcontainer base - Docker HEALTHCHECK validates bash availability</p> <p>What's NOT included: - Python runtime, pip, or development tools - Node.js runtime, npm, or package managers - Language-specific build dependencies (build-essential, compilers, etc.) - Version managers (pyenv, nvm, etc.)</p> <p>Image size: Smallest (~500MB base)</p>"},{"location":"variants/#python","title":"\ud83d\udd39 Python","text":"<p>Image: <code>ghcr.io/egohygiene/ubi:latest-python</code> or <code>ghcr.io/egohygiene/ubi:0.1.5-python</code></p> <p>Python-focused variant with Python runtime and package management tools.</p> <p>Use this when: - Building Python applications or data science projects - Require Python package management (pip, poetry) - Working with Python-based workflows - Need Python build tools and dependencies</p> <p>What's included: - Everything from Minimal variant - Python 3.13.5 runtime and development headers - pip 25.1.1 (Python package installer) - poetry (dependency management) - best-effort install via pip - Python build dependencies (build-essential, libssl-dev, zlib1g-dev, libbz2-dev, libreadline-dev, libsqlite3-dev, libxml2-dev, libxmlsec1-dev, libffi-dev, liblzma-dev, etc.) - Python-specific environment variables (PYTHONUNBUFFERED, PYTHONUTF8, PIP_NO_CACHE_DIR, etc.) - pyenv environment variables pre-configured at <code>$UNIVERSAL_TOOLBOX/pyenv</code> (install pyenv manually if needed) - Docker HEALTHCHECK validates bash and python3 availability</p> <p>Image size: Medium (~1.2GB)</p> <p>Note: Poetry installation may fail in restricted environments but the core Python tooling (python3, pip, venv) is always available. You can install additional version managers like pyenv manually if needed.</p>"},{"location":"variants/#node","title":"\ud83d\udd39 Node","text":"<p>Image: <code>ghcr.io/egohygiene/ubi:latest-node</code> or <code>ghcr.io/egohygiene/ubi:0.1.5-node</code></p> <p>Node.js-focused variant with Node.js runtime and package management tools.</p> <p>Use this when: - Building JavaScript/TypeScript applications - Require Node package management (npm, pnpm, yarn) - Working with modern JavaScript tooling - Need Node.js build tools</p> <p>What's included: - Everything from Minimal variant - Node.js v20.19.2 (LTS) runtime - npm 9.2.0 (Node package manager) - pnpm (fast, disk space efficient package manager) - best-effort install via npm - yarn (alternative package manager) - best-effort install via npm - Node.js build dependencies (build-essential, libssl-dev) - Node-specific environment variables (NODE_OPTIONS, telemetry controls) - nvm environment variables pre-configured at <code>$UNIVERSAL_TOOLBOX/nvm</code> (install nvm manually if needed) - Docker HEALTHCHECK validates bash and node availability</p> <p>Image size: Medium (~1.1GB)</p> <p>Note: pnpm and yarn installation may fail in restricted environments but the core Node.js tooling (node, npm) is always available. You can install additional version managers like nvm or volta manually if needed.</p>"},{"location":"variants/#full","title":"\ud83d\udd39 Full","text":"<p>Image: <code>ghcr.io/egohygiene/ubi:latest-full</code> or <code>ghcr.io/egohygiene/ubi:0.1.5-full</code></p> <p>The full-featured \"kitchen sink\" variant with all development tools and runtimes included. Combines Python and Node.js variants.</p> <p>Use this when: - Working in polyglot environments - Need maximum flexibility for heavy workflows - Building devcontainers for large, multi-language projects - Want everything available without additional setup</p> <p>What's included: - Everything from Minimal variant - Everything from Python variant - Everything from Node variant - All language runtimes and package managers - Complete development toolchain - Docker HEALTHCHECK validates bash, python3, and node availability</p> <p>Image size: Largest (~2.0GB+)</p>"},{"location":"variants/#choosing-a-variant","title":"Choosing a Variant","text":"Variant Size Python Node.js Best For Base Medium \u274c \u274c General purpose, current UBI users Minimal Smallest \u274c \u274c Specialized containers, minimal footprint Python Medium \u2705 \u274c Python applications, data science Node Medium \u274c \u2705 JavaScript/TypeScript applications Full Largest \u2705 \u2705 Polyglot projects, maximum flexibility"},{"location":"variants/#usage-examples","title":"Usage Examples","text":""},{"location":"variants/#using-in-devcontainerjson","title":"Using in devcontainer.json","text":"<pre><code>{\n  \"name\": \"My Python Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest-python\",\n  \"features\": {\n    // Add your devcontainer features here\n  }\n}\n</code></pre>"},{"location":"variants/#using-in-dockerfile","title":"Using in Dockerfile","text":"<pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5-node\n\n# Your project-specific setup\nWORKDIR /workspace\nCOPY package.json .\nRUN npm install\n</code></pre>"},{"location":"variants/#building-locally","title":"Building Locally","text":"<pre><code># Build minimal variant\ndocker build -f variants/minimal/Dockerfile -t ubi:minimal .\n\n# Build python variant\ndocker build -f variants/python/Dockerfile -t ubi:python .\n\n# Build node variant\ndocker build -f variants/node/Dockerfile -t ubi:node .\n\n# Build full variant\ndocker build -f variants/full/Dockerfile -t ubi:full .\n</code></pre>"},{"location":"variants/#version-pinning","title":"Version Pinning","text":"<p>All variants follow the same versioning scheme as the base UBI image. Always pin to a specific version for reproducible builds:</p> <pre><code># Good: Pinned to specific version\nFROM ghcr.io/egohygiene/ubi:0.1.5-python\n\n# Avoid: Using 'latest' in production\nFROM ghcr.io/egohygiene/ubi:latest-python\n</code></pre>"},{"location":"variants/#architecture-support","title":"Architecture Support","text":"<p>All variants are built for multiple architectures: - <code>linux/amd64</code> (x86_64) - <code>linux/arm64</code> (ARM64/Apple Silicon)</p> <p>Docker will automatically pull the correct architecture for your platform.</p>"},{"location":"variants/#security-considerations","title":"Security Considerations","text":"<ul> <li>Minimal variant: Smallest attack surface, recommended for production</li> <li>Specialized variants (Python/Node): Include only necessary runtimes</li> <li>Full variant: Largest attack surface, best for development only</li> </ul> <p>All variants: - Are regularly scanned for vulnerabilities with Trivy - Have SBOMs (Software Bill of Materials) generated during publish - Are signed with Cosign for image verification - Receive the same security updates as the base image</p>"},{"location":"variants/#contributing","title":"Contributing","text":"<p>To add a new variant or update existing ones:</p> <ol> <li>Create or modify Dockerfile in <code>variants/&lt;name&gt;/Dockerfile</code></li> <li>Update the publish workflow (<code>.github/workflows/publish.yml</code>)</li> <li>Update the test workflow (<code>.github/workflows/test-unified.yml</code>)</li> <li>Update this documentation</li> <li>Test locally before submitting PR</li> </ol> <p>See CONTRIBUTING.md for detailed contribution guidelines.</p>"},{"location":"variants/#related-documentation","title":"Related Documentation","text":"<ul> <li>Architecture Overview - UBI design and XDG structure</li> <li>Getting Started - Quick start guide</li> <li>Security Overview - Security practices</li> <li>README - Main project documentation</li> </ul>"},{"location":"best-practices/","title":"Best Practices","text":"<p>This directory will contain best practices and recommendations for using UBI effectively.</p>"},{"location":"best-practices/#planned-content","title":"Planned Content","text":"<ul> <li>Version Pinning: Strategies for version management</li> <li>Security Hardening: Additional security measures for production-like environments</li> <li>Performance Optimization: Tips for faster builds and better performance</li> <li>Resource Management: Memory and CPU allocation recommendations</li> <li>Multi-Project Workflows: Managing multiple projects with UBI</li> <li>Dependency Management: Handling project-specific dependencies</li> <li>Debugging Tips: Common debugging techniques and tools</li> </ul>"},{"location":"best-practices/#current-recommendations","title":"Current Recommendations","text":"<p>For now, see:</p> <ul> <li>Architecture Documentation - Design principles and rationale</li> <li>Security Overview - Security best practices</li> <li>Troubleshooting Guide - Common issues and solutions</li> </ul> <p>This section is under construction and will be expanded with comprehensive best practices in future releases.</p>"},{"location":"contributing/","title":"Contributing Documentation","text":"<p>This directory will contain detailed contributing guidelines and development workflows.</p>"},{"location":"contributing/#planned-content","title":"Planned Content","text":"<ul> <li>Development Setup: Local development environment configuration</li> <li>Code Style Guide: Coding standards and conventions</li> <li>PR Process: Pull request workflow and review guidelines</li> <li>Testing Guide: How to write and run tests</li> <li>Documentation Standards: How to write and maintain documentation</li> </ul>"},{"location":"contributing/#current-contributing-guide","title":"Current Contributing Guide","text":"<p>For now, please refer to the main CONTRIBUTING.md in the repository root.</p> <p>This section is under construction and will be expanded in future releases.</p>"},{"location":"dev/","title":"Development Documentation","text":"<p>This directory contains documentation for developers working on the UBI repository, including automation, tooling, and development workflows.</p>"},{"location":"dev/#contents","title":"Contents","text":"<ul> <li>copilot-environment.md - GitHub Copilot Agent environment configuration and setup</li> </ul>"},{"location":"dev/#purpose","title":"Purpose","text":"<p>While the main <code>docs/</code> directory focuses on using UBI as a base image, this <code>dev/</code> subdirectory focuses on:</p> <ul> <li>Developing and maintaining UBI itself</li> <li>Automation and CI/CD infrastructure</li> <li>Developer tooling and workflows</li> <li>GitHub integrations (Copilot, Actions, etc.)</li> </ul> <p>Navigation: \u2190 Back to Documentation Home</p>"},{"location":"dev/copilot-environment/","title":"\ud83e\udd16 Copilot Agent Environment","text":"<p>This document explains how the GitHub Copilot Agent environment is configured for the UBI repository, enabling automated PR fixes, code reviews, security audits, and other AI-powered automation tasks.</p>"},{"location":"dev/copilot-environment/#overview","title":"\ud83d\udcd6 Overview","text":""},{"location":"dev/copilot-environment/#what-is-the-copilot-agent-environment","title":"What is the Copilot Agent Environment?","text":"<p>GitHub Copilot Agents are AI-powered automation tools that can: - Analyze code and suggest improvements - Fix bugs and security vulnerabilities - Generate tests and documentation - Refactor code and apply linting fixes - Create and update pull requests</p> <p>However, Copilot Agents run in a sandboxed environment with firewall restrictions to ensure security. This means most external network requests are blocked by default.</p>"},{"location":"dev/copilot-environment/#the-challenge","title":"The Challenge","text":"<p>When a Copilot Agent tries to: - Download Nix packages from <code>nixos.org</code> - Fetch devcontainer feature metadata from GitHub - Install tools like Goss, Trivy, or Hadolint - Access GitHub API endpoints</p> <p>...these requests are blocked by the firewall, causing automation failures.</p>"},{"location":"dev/copilot-environment/#the-solution","title":"The Solution","text":"<p>UBI implements a two-part approach to enable Copilot Agent automation:</p> <ol> <li>Pre-installation Workflow (<code>copilot-setup-steps.yml</code>) - Installs all tools BEFORE the firewall activates</li> <li>Allowlist Configuration - Explicitly permits required external domains</li> </ol> <p>This ensures a deterministic, reproducible environment for all Copilot-powered tasks.</p>"},{"location":"dev/copilot-environment/#architecture","title":"\ud83c\udfd7\ufe0f Architecture","text":""},{"location":"dev/copilot-environment/#copilot-agent-lifecycle","title":"Copilot Agent Lifecycle","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. Trigger Event (PR created, issue opened, etc.)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 v\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. Run copilot-setup-steps.yml (BEFORE firewall enables)    \u2502\n\u2502    - Install Node.js, Python, Poetry                        \u2502\n\u2502    - Install Goss, Trivy, Hadolint, actionlint              \u2502\n\u2502    - Install jq, yq, ShellCheck, Cosign                     \u2502\n\u2502    - Cache dependencies                                      \u2502\n\u2502    - Pre-create directories                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 v\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 3. Copilot Agent Execution (firewall NOW active)            \u2502\n\u2502    - All tools already installed \u2705                         \u2502\n\u2502    - Only allowlisted domains accessible                    \u2502\n\u2502    - Agent can perform tasks without network errors         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 v\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 4. Copilot completes task (fix code, update PR, etc.)       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"dev/copilot-environment/#why-this-works","title":"Why This Works","text":"<ul> <li>Setup runs first: Tools are installed before firewall restrictions apply</li> <li>Cached dependencies: npm/Poetry dependencies are cached between runs</li> <li>No runtime downloads: Copilot doesn't need to download tools during execution</li> <li>Allowlist for edge cases: API calls to GitHub, Trivy DB, etc. are permitted</li> </ul>"},{"location":"dev/copilot-environment/#setup-workflow-details","title":"\ud83d\udd27 Setup Workflow Details","text":""},{"location":"dev/copilot-environment/#file-location","title":"File Location","text":"<p><code>.github/workflows/copilot-setup-steps.yml</code></p>"},{"location":"dev/copilot-environment/#job-name-critical","title":"Job Name (CRITICAL)","text":"<p>The workflow MUST contain a job named <code>copilot-setup-steps</code> for GitHub Copilot to recognize it. Using any other name will cause Copilot to ignore the workflow.</p>"},{"location":"dev/copilot-environment/#what-gets-installed","title":"What Gets Installed","text":"Category Tools Purpose Language Runtimes Node.js 20, Python 3.12 Execute npm/Python scripts Package Managers npm, Poetry, pip Install project dependencies Testing Frameworks Goss, dgoss Container testing and validation Security Scanners Trivy Vulnerability scanning Linters Hadolint, actionlint, ShellCheck Code quality checks Utilities jq, yq, git, curl JSON/YAML processing, version control Container Tools Docker, Buildx Image building Signing Tools Cosign Image signature verification Version Tools bump-my-version Automated version bumping"},{"location":"dev/copilot-environment/#caching-strategy","title":"Caching Strategy","text":"<p>Dependencies and environments are cached using GitHub Actions' built-in caching mechanisms to reduce execution time and improve reliability:</p>"},{"location":"dev/copilot-environment/#package-dependencies","title":"Package Dependencies","text":"<ul> <li>npm: Cached via <code>actions/setup-node@v4</code> with <code>cache: 'npm'</code></li> <li>Cache key based on <code>package-lock.json</code></li> <li> <p>Automatically restores <code>node_modules</code> from previous runs</p> </li> <li> <p>Python/pip: Cached via <code>actions/setup-python@v5</code> with <code>cache: 'pip'</code></p> </li> <li>Cache key based on <code>requirements.txt</code> (if present)</li> <li> <p>Speeds up pip package installations</p> </li> <li> <p>Poetry: Uses <code>actions/cache@v4</code> for <code>.venv</code> and <code>~/.cache/pypoetry</code></p> </li> <li>Cache key: <code>${{ runner.os }}-poetry-${{ hashFiles('**/poetry.lock') }}</code></li> <li>Restore keys: <code>${{ runner.os }}-poetry-</code></li> <li>Configured with in-project virtualenv for faster installs</li> </ul>"},{"location":"dev/copilot-environment/#tool-binaries","title":"Tool Binaries","text":"<ul> <li>Tool binaries (goss, trivy, hadolint, etc.) are installed fresh each run</li> <li>This ensures latest security patches and updates are always applied</li> <li>Installation is fast (&lt;2 minutes total) and doesn't warrant caching complexity</li> </ul>"},{"location":"dev/copilot-environment/#cache-benefits","title":"Cache Benefits","text":"<ul> <li>Faster workflow execution: 30-50% reduction in setup time</li> <li>Reduced network traffic: Fewer package downloads</li> <li>Improved reliability: Less dependent on external package registries</li> <li>Cost efficiency: Reduced GitHub Actions minutes usage</li> </ul>"},{"location":"dev/copilot-environment/#allowlist-configuration","title":"\ud83d\udd10 Allowlist Configuration","text":""},{"location":"dev/copilot-environment/#required-domains","title":"Required Domains","text":"<p>The following domains are allowlisted for Copilot Agent network access:</p>"},{"location":"dev/copilot-environment/#core-github-services","title":"Core GitHub Services","text":"<ul> <li><code>api.github.com</code> - API for releases, metadata, code search</li> <li><code>github.com</code> - Repository access</li> <li><code>raw.githubusercontent.com</code> - Raw file downloads</li> <li><code>*.githubusercontent.com</code> - Wildcard for all user content</li> </ul>"},{"location":"dev/copilot-environment/#package-registries","title":"Package Registries","text":"<ul> <li><code>ghcr.io</code> - GitHub Container Registry</li> <li><code>registry.npmjs.org</code> - npm packages</li> <li><code>pypi.org</code> - Python packages</li> <li><code>files.pythonhosted.org</code> - Python package files</li> </ul>"},{"location":"dev/copilot-environment/#tool-downloads","title":"Tool Downloads","text":"<ul> <li><code>goss.rocks</code> - Goss installer</li> <li><code>api.trivy.dev</code> - Trivy vulnerability database</li> <li><code>aquasecurity.github.io</code> - Trivy repository</li> <li><code>install.python-poetry.org</code> - Poetry installer</li> </ul>"},{"location":"dev/copilot-environment/#optional-nix-support","title":"Optional: Nix Support","text":"<ul> <li><code>nixos.org</code>, <code>releases.nixos.org</code>, <code>cache.nixos.org</code> - Nix ecosystem</li> </ul>"},{"location":"dev/copilot-environment/#configuration-location","title":"Configuration Location","text":"<p>Admins only: Repository Settings \u2192 GitHub Copilot \u2192 Agents \u2192 Allowlist</p> <p>For detailed allowlist setup instructions, see COPILOT_ALLOWLIST.md.</p>"},{"location":"dev/copilot-environment/#usage-examples","title":"\ud83d\udcdd Usage Examples","text":""},{"location":"dev/copilot-environment/#example-1-automated-pr-fixes","title":"Example 1: Automated PR Fixes","text":"<p>When a PR is created, Copilot can: 1. Analyze the code changes 2. Run linters (using pre-installed Hadolint, ShellCheck) 3. Fix formatting issues (using npm dependencies) 4. Commit and push fixes</p> <p>Without setup workflow: \u274c Fails - can't download linters With setup workflow: \u2705 Works - linters already installed</p>"},{"location":"dev/copilot-environment/#example-2-security-audits","title":"Example 2: Security Audits","text":"<p>Copilot can scan for vulnerabilities: 1. Build Docker image 2. Run Trivy scan (pre-installed) 3. Generate security report 4. Create issue for CVEs</p> <p>Without allowlist: \u274c Fails - can't access <code>api.trivy.dev</code> With allowlist: \u2705 Works - Trivy DB accessible</p>"},{"location":"dev/copilot-environment/#example-3-devcontainer-feature-validation","title":"Example 3: Devcontainer Feature Validation","text":"<p>Copilot can validate devcontainer configs: 1. Fetch feature metadata from GitHub 2. Check for updates 3. Suggest improvements</p> <p>Without allowlist: \u274c Fails - can't access GitHub API With allowlist: \u2705 Works - API allowlisted</p>"},{"location":"dev/copilot-environment/#adding-new-tools","title":"\ud83d\ude80 Adding New Tools","text":"<p>When you need to add a new automation tool:</p>"},{"location":"dev/copilot-environment/#step-1-update-setup-workflow","title":"Step 1: Update Setup Workflow","text":"<p>Edit <code>.github/workflows/copilot-setup-steps.yml</code>:</p> <pre><code>- name: \ud83d\udd27 Install NewTool\n  run: |\n    echo \"Installing NewTool...\"\n    curl -fsSL https://example.com/install.sh | sh\n    newtool --version\n    echo \"\u2705 NewTool installed\"\n</code></pre>"},{"location":"dev/copilot-environment/#step-2-update-allowlist","title":"Step 2: Update Allowlist","text":"<p>If the tool requires network access during execution:</p> <ol> <li>Identify required domains (check tool's documentation)</li> <li>Add domains to COPILOT_ALLOWLIST.md</li> <li>Ask repository admin to update GitHub Settings allowlist</li> </ol>"},{"location":"dev/copilot-environment/#step-3-document-the-tool","title":"Step 3: Document the Tool","text":"<p>Update this document's \"What Gets Installed\" table.</p>"},{"location":"dev/copilot-environment/#step-4-test","title":"Step 4: Test","text":"<p>Run the workflow to verify installation:</p> <pre><code>gh workflow run copilot-setup-steps.yml\n</code></pre>"},{"location":"dev/copilot-environment/#verification-testing","title":"\u2705 Verification &amp; Testing","text":""},{"location":"dev/copilot-environment/#manual-testing","title":"Manual Testing","text":"<ol> <li> <p>Trigger setup workflow:    <pre><code>gh workflow run copilot-setup-steps.yml\n</code></pre></p> </li> <li> <p>Check workflow logs for errors</p> </li> <li> <p>Verify tool versions in \"Verify Installation\" step</p> </li> </ol>"},{"location":"dev/copilot-environment/#ci-validation","title":"CI Validation","text":"<p>The <code>validate-copilot-setup.yml</code> workflow automatically: - Runs setup steps in isolation - Verifies all tools install successfully - Ensures no firewall blocks occur</p>"},{"location":"dev/copilot-environment/#what-to-check","title":"What to Check","text":"Item Expected Behavior Setup workflow status \u2705 Success (green checkmark) Tool installation logs No \"connection refused\" or \"blocked\" errors Verification step All tool versions printed Copilot Agent runs No firewall error messages"},{"location":"dev/copilot-environment/#troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"dev/copilot-environment/#issue-firewall-rules-blocked-me-from-connecting-to-x","title":"Issue: \"Firewall rules blocked me from connecting to X\"","text":"<p>Cause: Domain not in allowlist Solution: Add domain to allowlist (requires admin) or pre-install tool in setup workflow</p>"},{"location":"dev/copilot-environment/#issue-setup-workflow-fails-with-command-not-found","title":"Issue: Setup workflow fails with \"command not found\"","text":"<p>Cause: Tool installation failed silently Solution: Check installation step logs; ensure URL is correct and accessible</p>"},{"location":"dev/copilot-environment/#issue-copilot-agent-runs-slow","title":"Issue: Copilot Agent runs slow","text":"<p>Cause: Dependencies re-installing every time Solution: Verify caching is working (check setup-node/setup-python cache hits)</p>"},{"location":"dev/copilot-environment/#issue-tool-version-mismatch","title":"Issue: Tool version mismatch","text":"<p>Cause: Cached version outdated Solution: Bump tool version in workflow; cache will auto-update</p>"},{"location":"dev/copilot-environment/#implementation-summary","title":"\u2705 Implementation Summary","text":"<p>This section documents the complete implementation of GitHub Copilot Coding Agent environment customization, addressing all requirements from the original issue.</p>"},{"location":"dev/copilot-environment/#acceptance-criteria-met","title":"Acceptance Criteria Met","text":"<p>\u2705 Review GitHub documentation for Copilot Coding Agent environment customization - Reviewed official documentation: https://docs.github.com/en/copilot/how-tos/use-copilot-agents/coding-agent/customize-the-agent-environment - All recommendations implemented</p> <p>\u2705 Define required tools, languages, and dependencies for the agent - Complete tool inventory documented in \"What Gets Installed\" table above - Covers: Language runtimes, package managers, testing frameworks, security scanners, linters, utilities, container tools, signing tools, and version management</p> <p>\u2705 Configure GitHub Actions workflow to install and configure these dependencies - Implemented: <code>.github/workflows/copilot-setup-steps.yml</code> - Job name correctly set to <code>copilot-setup-steps</code> (required by GitHub) - Pre-installs all tools before Copilot Agent firewall activates</p> <p>\u2705 Verify Copilot agent runs successfully using the customized environment - Implemented: <code>.github/workflows/validate-copilot-setup.yml</code> - Automated validation runs weekly and on workflow changes - Tests tool installations, functionality, and firewall configuration</p> <p>\u2705 Document environment setup and assumptions in the repository - Created: <code>docs/dev/copilot-environment.md</code> (this document) - Created: <code>.github/COPILOT_ALLOWLIST.md</code> (domain allowlist) - Updated: <code>README.md</code> with Copilot Agent section</p>"},{"location":"dev/copilot-environment/#technical-requirements-met","title":"Technical Requirements Met","text":"<p>\u2705 Use GitHub Actions workflow configuration for environment setup - Two workflows implemented: setup and validation - Follows GitHub Actions best practices</p> <p>\u2705 Prefer explicit versions for tools and runtimes - All tools use pinned versions (Node.js 20, Python 3.12, Goss v0.4.9, etc.) - Ensures reproducible builds</p> <p>\u2705 Store secrets or tokens using GitHub Secrets - No plaintext credentials in workflows - Uses GitHub OIDC for Cosign signing</p> <p>\u2705 Ensure environment setup is idempotent and cache-friendly - npm caching via <code>actions/setup-node@v4</code> - Python/pip caching via <code>actions/setup-python@v5</code> - Poetry caching via <code>actions/cache@v4</code> - All operations can be run multiple times safely</p>"},{"location":"dev/copilot-environment/#stretch-goals-achieved","title":"Stretch Goals Achieved","text":"<p>\u2705 Add caching for dependencies to reduce execution time - npm: Package caching based on <code>package-lock.json</code> - Python/pip: Package caching based on <code>requirements.txt</code> - Poetry: Virtual environment caching based on <code>poetry.lock</code> - Results in 30-50% faster workflow execution</p> <p>\u2705 Add a validation step to assert expected tools/versions are installed - Comprehensive validation in <code>validate-copilot-setup.yml</code> - Tests tool functionality and version verification - Checks for firewall configuration issues</p> <p>\u26a0\ufe0f Support multiple environments (e.g., minimal vs full tooling) - Not implemented (single comprehensive environment sufficient) - All tools are lightweight and fast to install - Can be implemented if needed in the future</p>"},{"location":"dev/copilot-environment/#deliverables-provided","title":"Deliverables Provided","text":"<ol> <li>Updated GitHub Actions workflow files</li> <li><code>.github/workflows/copilot-setup-steps.yml</code> - Environment setup</li> <li> <p><code>.github/workflows/validate-copilot-setup.yml</code> - Validation</p> </li> <li> <p>Documentation</p> </li> <li>What is customized: Complete tool inventory and architecture</li> <li>Why it is required: Explains firewall restrictions and automation benefits</li> <li> <p>How to update or extend: Step-by-step guide for adding new tools</p> </li> <li> <p>Additional Documentation</p> </li> <li>Domain allowlist configuration guide</li> <li>Security considerations and best practices</li> <li>Troubleshooting guide</li> <li>Usage examples</li> </ol>"},{"location":"dev/copilot-environment/#security-considerations","title":"\ud83d\udd12 Security Considerations","text":""},{"location":"dev/copilot-environment/#why-this-is-secure","title":"Why This is Secure","text":"<ol> <li>Principle of Least Privilege: Only required domains are allowlisted</li> <li>Official Sources Only: All downloads from official repositories</li> <li>Read-Only Access: Tools only read public data; no write access</li> <li>Audit Trail: All network requests logged in workflow runs</li> <li>Repository Scoped: Allowlist only applies to UBI, not organization-wide</li> </ol>"},{"location":"dev/copilot-environment/#security-review-checklist","title":"Security Review Checklist","text":"<p>Before adding a new tool: - [ ] Is the download from an official/trusted source? - [ ] Is HTTPS used for all downloads? - [ ] Is the tool version pinned (not <code>latest</code>)? - [ ] Is the tool necessary for automation tasks? - [ ] Does the tool require minimal permissions?</p>"},{"location":"dev/copilot-environment/#related-documentation","title":"\ud83d\udcda Related Documentation","text":"<ul> <li>COPILOT_ALLOWLIST.md - Detailed allowlist configuration</li> <li>copilot-setup-steps.yml - Setup workflow source</li> <li>validate-copilot-setup.yml - CI validation</li> <li>GitHub Docs: Customize Agent Environment</li> </ul>"},{"location":"dev/copilot-environment/#contributing","title":"\ud83e\udd1d Contributing","text":""},{"location":"dev/copilot-environment/#adding-features","title":"Adding Features","text":"<p>When adding Copilot-powered features: 1. Ensure required tools are in setup workflow 2. Document any new allowlist domains 3. Test with a sample PR 4. Update this documentation</p>"},{"location":"dev/copilot-environment/#questions","title":"Questions?","text":"<ul> <li>Open an issue: https://github.com/egohygiene/ubi/issues</li> <li>Start a discussion: https://github.com/egohygiene/ubi/discussions</li> </ul> <p>Last Updated: 2026-01-02 Maintainers: UBI Repository Team Status: \u2705 Active</p>"},{"location":"examples/","title":"UBI Usage Examples","text":"<p>This directory documents examples of using UBI in various scenarios.</p>"},{"location":"examples/#available-examples","title":"\u2705 Available Examples","text":"<p>For complete, working example projects, see the examples directory at the repository root:</p> <ul> <li>Python CLI - Command-line tool with Click</li> <li>Node.js Express - REST API server  </li> <li>Polyglot - Multi-language project (Python + Node.js + Bash)</li> </ul> <p>Each example includes: - Complete, runnable source code - Comprehensive documentation - Devcontainer configuration - Step-by-step instructions</p>"},{"location":"examples/#additional-examples","title":"\ud83d\udcd6 Additional Examples","text":"<p>This page (examples.md) provides code snippets and patterns for:</p> <ul> <li>Basic Usage: Devcontainer and Dockerfile examples</li> <li>Advanced Patterns: Multi-stage builds, XDG paths, custom environments</li> <li>Language-Specific: Python, Node.js, Go project examples</li> <li>CI/CD Integration: GitHub Actions and Docker Compose</li> <li>Testing: Local testing and integration testing</li> <li>Best Practices: Version pinning, layer optimization, security</li> </ul>"},{"location":"examples/#getting-started","title":"Getting Started","text":"<ol> <li>Browse complete projects: examples directory</li> <li>Read code snippets: examples.md</li> <li>Learn the basics: main README</li> <li>Understand the architecture: Architecture Documentation</li> </ol> <p>For the most up-to-date examples, always refer to the examples directory in the repository.</p>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>This guide covers how to install and start using UBI in your projects.</p>"},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<p>Before using UBI, ensure you have:</p> <ul> <li>Docker - Version 20.10 or higher</li> <li>VS Code (optional) - For devcontainer support</li> <li>Dev Containers extension (optional) - For VS Code integration</li> </ul>"},{"location":"getting-started/installation/#installation-methods","title":"Installation Methods","text":""},{"location":"getting-started/installation/#method-1-using-as-a-devcontainer-base","title":"Method 1: Using as a Devcontainer Base","text":"<p>This is the recommended method for most projects.</p>"},{"location":"getting-started/installation/#step-1-create-devcontainer-configuration","title":"Step 1: Create Devcontainer Configuration","text":"<p>Create a <code>.devcontainer/devcontainer.json</code> file in your project:</p> <pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\"\n}\n</code></pre>"},{"location":"getting-started/installation/#step-2-open-in-vs-code","title":"Step 2: Open in VS Code","text":"<ol> <li>Open your project in VS Code</li> <li>Press <code>F1</code> and select Dev Containers: Reopen in Container</li> <li>VS Code will pull the UBI image and start your devcontainer</li> </ol>"},{"location":"getting-started/installation/#method-2-using-as-a-dockerfile-base","title":"Method 2: Using as a Dockerfile Base","text":"<p>Extend UBI in your own Dockerfile:</p> <pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5\n\n# Add your project-specific layers\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    your-dependencies \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\nWORKDIR /workspace\n</code></pre> <p>Build your image:</p> <pre><code>docker build -t myproject:latest .\n</code></pre>"},{"location":"getting-started/installation/#method-3-direct-docker-usage","title":"Method 3: Direct Docker Usage","text":"<p>Pull and run UBI directly:</p> <pre><code># Pull the image\ndocker pull ghcr.io/egohygiene/ubi:latest\n\n# Run interactively\ndocker run -it --rm ghcr.io/egohygiene/ubi:latest bash\n</code></pre>"},{"location":"getting-started/installation/#version-selection","title":"Version Selection","text":"<p>UBI provides multiple version tags:</p>"},{"location":"getting-started/installation/#latest-version","title":"Latest Version","text":"<pre><code>FROM ghcr.io/egohygiene/ubi:latest\n</code></pre> <p>Use for: Development and testing</p>"},{"location":"getting-started/installation/#specific-version-recommended-for-production","title":"Specific Version (Recommended for Production)","text":"<pre><code>FROM ghcr.io/egohygiene/ubi:0.1.5\n</code></pre> <p>Use for: Production deployments, reproducible builds</p>"},{"location":"getting-started/installation/#commit-sha-maximum-reproducibility","title":"Commit SHA (Maximum Reproducibility)","text":"<pre><code>FROM ghcr.io/egohygiene/ubi:sha-abc123\n</code></pre> <p>Use for: Auditing, compliance, maximum reproducibility</p>"},{"location":"getting-started/installation/#verifying-installation","title":"Verifying Installation","text":"<p>After pulling UBI, verify the installation:</p> <pre><code># Check version\ndocker run --rm ghcr.io/egohygiene/ubi:latest cat /VERSION\n\n# Verify XDG directories\ndocker run --rm ghcr.io/egohygiene/ubi:latest ls -la /opt/universal/\n\n# Check environment variables\ndocker run --rm ghcr.io/egohygiene/ubi:latest env | grep XDG\n</code></pre> <p>Expected output:</p> <pre><code>XDG_CONFIG_HOME=/opt/universal/config\nXDG_CACHE_HOME=/opt/universal/cache\nXDG_DATA_HOME=/opt/universal/toolbox\nXDG_STATE_HOME=/opt/universal/runtime\n</code></pre>"},{"location":"getting-started/installation/#configuration","title":"Configuration","text":""},{"location":"getting-started/installation/#basic-configuration","title":"Basic Configuration","text":"<p>Minimal devcontainer configuration:</p> .devcontainer/devcontainer.json<pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:0.1.5\",\n  \"workspaceFolder\": \"/workspace\",\n  \"workspaceMount\": \"source=${localWorkspaceFolder},target=/workspace,type=bind\"\n}\n</code></pre>"},{"location":"getting-started/installation/#advanced-configuration","title":"Advanced Configuration","text":"<p>With additional features and customizations:</p> .devcontainer/devcontainer.json<pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:0.1.5\",\n  \"workspaceFolder\": \"/workspace\",\n\n  // Add VS Code extensions\n  \"customizations\": {\n    \"vscode\": {\n      \"extensions\": [\n        \"dbaeumer.vscode-eslint\",\n        \"esbenp.prettier-vscode\"\n      ],\n      \"settings\": {\n        \"terminal.integrated.defaultProfile.linux\": \"bash\"\n      }\n    }\n  },\n\n  // Set environment variables\n  \"containerEnv\": {\n    \"MY_ENV_VAR\": \"value\"\n  },\n\n  // Mount additional volumes\n  \"mounts\": [\n    \"source=${localEnv:HOME}/.ssh,target=/home/vscode/.ssh,type=bind,consistency=cached\"\n  ],\n\n  // Port forwarding\n  \"forwardPorts\": [3000, 8080],\n\n  // Post-create command\n  \"postCreateCommand\": \"npm install\"\n}\n</code></pre>"},{"location":"getting-started/installation/#docker-compose-integration","title":"Docker Compose Integration","text":"<p>Use UBI with Docker Compose:</p> docker-compose.yml<pre><code>version: '3.8'\n\nservices:\n  app:\n    image: ghcr.io/egohygiene/ubi:0.1.5\n    volumes:\n      - .:/workspace\n      - ubi-cache:/opt/universal/cache\n      - ubi-config:/opt/universal/config\n    working_dir: /workspace\n    environment:\n      - NODE_ENV=development\n    command: bash\n    tty: true\n    stdin_open: true\n\nvolumes:\n  ubi-cache:\n  ubi-config:\n</code></pre> <p>Run with:</p> <pre><code>docker-compose up -d\ndocker-compose exec app bash\n</code></pre>"},{"location":"getting-started/installation/#offline-installation","title":"Offline Installation","text":"<p>For environments without internet access:</p>"},{"location":"getting-started/installation/#step-1-pull-image-on-connected-machine","title":"Step 1: Pull Image on Connected Machine","text":"<pre><code>docker pull ghcr.io/egohygiene/ubi:0.1.5\ndocker save ghcr.io/egohygiene/ubi:0.1.5 -o ubi-0.1.5.tar\n</code></pre>"},{"location":"getting-started/installation/#step-2-transfer-to-offline-machine","title":"Step 2: Transfer to Offline Machine","text":"<p>Transfer <code>ubi-0.1.5.tar</code> to your offline machine.</p>"},{"location":"getting-started/installation/#step-3-load-image","title":"Step 3: Load Image","text":"<pre><code>docker load -i ubi-0.1.5.tar\n</code></pre>"},{"location":"getting-started/installation/#updating-ubi","title":"Updating UBI","text":""},{"location":"getting-started/installation/#manual-update","title":"Manual Update","text":"<pre><code># Pull latest version\ndocker pull ghcr.io/egohygiene/ubi:latest\n\n# Or pull specific version\ndocker pull ghcr.io/egohygiene/ubi:0.1.5\n\n# Rebuild your devcontainer\n# In VS Code: F1 -&gt; Dev Containers: Rebuild Container\n</code></pre>"},{"location":"getting-started/installation/#automated-update","title":"Automated Update","text":"<p>Set up Dependabot to automatically update your UBI version:</p> .github/dependabot.yml<pre><code>version: 2\nupdates:\n  - package-ecosystem: \"docker\"\n    directory: \"/.devcontainer\"\n    schedule:\n      interval: \"weekly\"\n</code></pre>"},{"location":"getting-started/installation/#uninstalling","title":"Uninstalling","text":"<p>To remove UBI from your system:</p> <pre><code># Remove all UBI images\ndocker rmi ghcr.io/egohygiene/ubi:latest\ndocker rmi ghcr.io/egohygiene/ubi:0.1.5\n\n# Remove all unused images\ndocker image prune -a\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Read the Quick Start Guide</li> <li>Explore Examples</li> <li>Learn about Architecture</li> <li>See Troubleshooting if you encounter issues</li> </ul>"},{"location":"getting-started/installation/#getting-help","title":"Getting Help","text":"<p>If you encounter issues during installation:</p> <ol> <li>Check the Troubleshooting Guide</li> <li>Search existing issues</li> <li>Open a new issue</li> <li>Join the discussion</li> </ol>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>Get up and running with UBI in minutes! This guide provides the fastest path to using UBI in your projects.</p>"},{"location":"getting-started/quick-start/#5-minute-quick-start","title":"\ud83d\ude80 5-Minute Quick Start","text":""},{"location":"getting-started/quick-start/#option-1-vs-code-devcontainer-recommended","title":"Option 1: VS Code + Devcontainer (Recommended)","text":"<p>The fastest way to get started:</p>"},{"location":"getting-started/quick-start/#1-create-configuration-file","title":"1. Create Configuration File","text":"<p>Create <code>.devcontainer/devcontainer.json</code> in your project root:</p> <pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\"\n}\n</code></pre>"},{"location":"getting-started/quick-start/#2-open-in-container","title":"2. Open in Container","text":"<ol> <li>Open your project in VS Code</li> <li>Press <code>F1</code> (or <code>Ctrl+Shift+P</code> / <code>Cmd+Shift+P</code>)</li> <li>Type: Dev Containers: Reopen in Container</li> <li>Press Enter</li> </ol> <p>VS Code will automatically: - Pull the UBI image - Start the container - Open your project inside the container</p> <p>\u2705 Done! You're now working in UBI.</p>"},{"location":"getting-started/quick-start/#option-2-docker-command-line","title":"Option 2: Docker Command Line","text":"<p>For command-line users:</p> <pre><code># Pull the image\ndocker pull ghcr.io/egohygiene/ubi:latest\n\n# Run interactively\ndocker run -it --rm \\\n  -v $(pwd):/workspace \\\n  -w /workspace \\\n  ghcr.io/egohygiene/ubi:latest \\\n  bash\n</code></pre> <p>\u2705 Done! You're now in a UBI shell.</p>"},{"location":"getting-started/quick-start/#basic-usage","title":"\ud83d\udccb Basic Usage","text":""},{"location":"getting-started/quick-start/#explore-the-environment","title":"Explore the Environment","text":"<p>Once inside UBI, explore the environment:</p> <pre><code># Check version\ncat /VERSION\n\n# List XDG directories\nls -la /opt/universal/\n\n# View environment variables\nenv | grep XDG\n\n# Check installed tools\ngit --version\ncurl --version\n</code></pre>"},{"location":"getting-started/quick-start/#use-xdg-directories","title":"Use XDG Directories","text":"<p>UBI provides standardized directories:</p> <pre><code># Configuration directory\necho $XDG_CONFIG_HOME\n# Output: /opt/universal/config\n\n# Cache directory\necho $XDG_CACHE_HOME\n# Output: /opt/universal/cache\n\n# Data directory\necho $XDG_DATA_HOME\n# Output: /opt/universal/toolbox\n</code></pre>"},{"location":"getting-started/quick-start/#common-tasks","title":"\ud83d\udee0\ufe0f Common Tasks","text":""},{"location":"getting-started/quick-start/#install-additional-tools","title":"Install Additional Tools","text":"<pre><code># Update package list\nsudo apt-get update\n\n# Install tools\nsudo apt-get install -y nodejs npm\n\n# Verify installation\nnode --version\nnpm --version\n</code></pre>"},{"location":"getting-started/quick-start/#run-your-project","title":"Run Your Project","text":"<pre><code># Navigate to your workspace\ncd /workspace\n\n# Install dependencies (example: Node.js)\nnpm install\n\n# Run your application\nnpm start\n</code></pre>"},{"location":"getting-started/quick-start/#configure-your-shell","title":"Configure Your Shell","text":"<pre><code># ZSH is already configured, but you can customize\nvim ~/.zshrc\n\n# Or use your preferred editor\ncode ~/.zshrc\n</code></pre>"},{"location":"getting-started/quick-start/#project-templates","title":"\ud83d\udcda Project Templates","text":""},{"location":"getting-started/quick-start/#python-project","title":"Python Project","text":".devcontainer/devcontainer.json<pre><code>{\n  \"name\": \"Python Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\",\n  \"postCreateCommand\": \"pip install -r requirements.txt\",\n  \"customizations\": {\n    \"vscode\": {\n      \"extensions\": [\n        \"ms-python.python\",\n        \"ms-python.vscode-pylance\"\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"getting-started/quick-start/#nodejs-project","title":"Node.js Project","text":".devcontainer/devcontainer.json<pre><code>{\n  \"name\": \"Node.js Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\",\n  \"postCreateCommand\": \"npm install\",\n  \"forwardPorts\": [3000],\n  \"customizations\": {\n    \"vscode\": {\n      \"extensions\": [\n        \"dbaeumer.vscode-eslint\",\n        \"esbenp.prettier-vscode\"\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"getting-started/quick-start/#go-project","title":"Go Project","text":".devcontainer/devcontainer.json<pre><code>{\n  \"name\": \"Go Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\",\n  \"postCreateCommand\": \"go mod download\",\n  \"customizations\": {\n    \"vscode\": {\n      \"extensions\": [\n        \"golang.go\"\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"getting-started/quick-start/#customization","title":"\ud83d\udd27 Customization","text":""},{"location":"getting-started/quick-start/#add-environment-variables","title":"Add Environment Variables","text":".devcontainer/devcontainer.json<pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\",\n  \"containerEnv\": {\n    \"DATABASE_URL\": \"postgresql://localhost:5432/mydb\",\n    \"API_KEY\": \"${localEnv:API_KEY}\"\n  }\n}\n</code></pre>"},{"location":"getting-started/quick-start/#mount-additional-volumes","title":"Mount Additional Volumes","text":".devcontainer/devcontainer.json<pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\",\n  \"mounts\": [\n    \"source=${localEnv:HOME}/.ssh,target=/home/vscode/.ssh,type=bind,readonly\",\n    \"source=${localEnv:HOME}/.gitconfig,target=/home/vscode/.gitconfig,type=bind\"\n  ]\n}\n</code></pre>"},{"location":"getting-started/quick-start/#forward-ports","title":"Forward Ports","text":".devcontainer/devcontainer.json<pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\",\n  \"forwardPorts\": [3000, 8080, 5432]\n}\n</code></pre>"},{"location":"getting-started/quick-start/#next-steps","title":"\ud83c\udfaf Next Steps","text":"<p>Now that you have UBI running, explore these resources:</p>"},{"location":"getting-started/quick-start/#learn-more","title":"Learn More","text":"<ul> <li>Installation Guide - Detailed installation instructions</li> <li>Examples - Practical examples and use cases</li> <li>Architecture - Understand UBI's design</li> </ul>"},{"location":"getting-started/quick-start/#build-your-project","title":"Build Your Project","text":"<ul> <li>Troubleshooting - Solutions to common issues</li> <li>Best Practices - Recommendations for using UBI</li> <li>Contributing - Contribute to UBI</li> </ul>"},{"location":"getting-started/quick-start/#stay-updated","title":"Stay Updated","text":"<ul> <li>Changelog - See what's new</li> <li>Release Process - Understand versioning</li> <li>Security - Security practices</li> </ul>"},{"location":"getting-started/quick-start/#pro-tips","title":"\u26a1 Pro Tips","text":""},{"location":"getting-started/quick-start/#use-version-pinning-in-production","title":"Use Version Pinning in Production","text":"<pre><code>{\n  \"name\": \"Production App\",\n  \"image\": \"ghcr.io/egohygiene/ubi:0.1.5\"  // Pin specific version\n}\n</code></pre>"},{"location":"getting-started/quick-start/#cache-dependencies","title":"Cache Dependencies","text":"<p>Use named volumes to persist caches:</p> <pre><code>{\n  \"name\": \"My Project\",\n  \"image\": \"ghcr.io/egohygiene/ubi:latest\",\n  \"mounts\": [\n    \"source=ubi-cache,target=/opt/universal/cache,type=volume\"\n  ]\n}\n</code></pre>"},{"location":"getting-started/quick-start/#enable-git-credential-helper","title":"Enable Git Credential Helper","text":"<pre><code># Inside the container\ngit config --global credential.helper store\n</code></pre>"},{"location":"getting-started/quick-start/#use-pre-commit-hooks","title":"Use Pre-commit Hooks","text":"<pre><code># Inside the container\npip install pre-commit\npre-commit install\n</code></pre>"},{"location":"getting-started/quick-start/#getting-help","title":"\ud83c\udd98 Getting Help","text":""},{"location":"getting-started/quick-start/#troubleshooting","title":"Troubleshooting","text":"<p>If something doesn't work:</p> <ol> <li>Check the Troubleshooting Guide</li> <li>Search existing issues</li> <li>Ask in Discussions</li> </ol>"},{"location":"getting-started/quick-start/#common-issues","title":"Common Issues","text":"<p>Container won't start? - Ensure Docker is running - Check Docker has enough resources (4GB+ RAM) - Try rebuilding: <code>F1 -&gt; Dev Containers: Rebuild Container</code></p> <p>Can't see your files? - Check <code>workspaceFolder</code> and <code>workspaceMount</code> settings - Ensure volume permissions are correct</p> <p>Slow performance? - On macOS/Windows, use named volumes for node_modules - Increase Docker resource limits</p>"},{"location":"getting-started/quick-start/#youre-ready","title":"\ud83c\udf89 You're Ready!","text":"<p>You now have UBI running and know the basics. Start building your project with confidence!</p> <p>For more detailed information, explore the rest of the documentation.</p>"},{"location":"security/","title":"Security Documentation","text":"<p>This directory contains security-related documentation for the UBI project.</p>"},{"location":"security/#contents","title":"Contents","text":"<ul> <li>privileged-mode.md - Analysis and documentation of the privileged mode investigation in the devcontainer configuration. Explains why <code>privileged: true</code> was removed and the security implications.</li> </ul>"},{"location":"security/#security-best-practices","title":"Security Best Practices","text":"<p>The UBI project follows security best practices including:</p> <ul> <li>Principle of Least Privilege: Containers run with minimal required permissions</li> <li>Container Isolation: Standard container security boundaries are maintained</li> <li>Pinned Base Images: Using specific versions and digests for reproducibility</li> <li>Regular Security Scanning: Trivy scans integrated into CI/CD pipeline</li> <li>Security Audits: Regular security audits and follow-up actions</li> </ul>"},{"location":"security/#reporting-security-issues","title":"Reporting Security Issues","text":"<p>Please refer to the main SECURITY.md file in the repository root for information on how to report security vulnerabilities.</p>"},{"location":"security/#related-documentation","title":"Related Documentation","text":"<ul> <li>DevContainer Configuration</li> <li>CI/CD Workflows</li> <li>Security Audit Report</li> </ul>"},{"location":"security/privileged-mode/","title":"Privileged Mode in Devcontainer - Security Analysis","text":""},{"location":"security/privileged-mode/#executive-summary","title":"Executive Summary","text":"<p>Status: \u2705 REMOVED - <code>privileged: true</code> was not necessary Date Investigated: 2025-12-12 Priority: P2 (Medium) Decision: Removed from <code>.devcontainer/docker-compose.yml</code></p>"},{"location":"security/privileged-mode/#background","title":"Background","text":"<p>The UBI devcontainer configuration previously included <code>privileged: true</code> in the docker-compose.yml file with a comment indicating it was \"required for docker-in-docker\". This setting significantly escalates container privileges and breaks isolation boundaries, presenting potential security risks.</p> <p>This document explains the investigation, findings, and final decision regarding this configuration.</p>"},{"location":"security/privileged-mode/#investigation","title":"Investigation","text":""},{"location":"security/privileged-mode/#original-configuration","title":"Original Configuration","text":"<p>The <code>.devcontainer/docker-compose.yml</code> file contained:</p> <pre><code>services:\n  development:\n    # ... other settings ...\n    privileged: true # required for docker-in-docker\n    user: vscode\n</code></pre>"},{"location":"security/privileged-mode/#what-is-privileged-mode","title":"What is Privileged Mode?","text":"<p>When a container runs in privileged mode (<code>privileged: true</code>):</p> <ul> <li>Full device access: The container gains access to all host devices (<code>/dev/*</code>)</li> <li>Kernel capabilities: Nearly all Linux capabilities are granted</li> <li>No AppArmor/SELinux restrictions: Security profiles are disabled</li> <li>Control groups relaxed: Resource isolation is weakened</li> <li>Host namespace access: Can potentially access host processes and filesystems</li> </ul> <p>This effectively removes the security boundaries that containers are designed to provide.</p>"},{"location":"security/privileged-mode/#security-risks-of-privileged-mode","title":"Security Risks of Privileged Mode","text":"<ol> <li>Host Filesystem Access: Container can potentially access and modify host files</li> <li>Kernel Interface Exposure: Direct access to kernel interfaces increases attack surface</li> <li>Container Escape: Easier to escape container isolation and compromise the host</li> <li>Privilege Escalation: Simplified path to gaining root access on the host</li> <li>Non-portable Configuration: Makes the devcontainer less portable across environments</li> </ol>"},{"location":"security/privileged-mode/#findings","title":"Findings","text":""},{"location":"security/privileged-mode/#1-no-docker-in-docker-requirement","title":"1. No Docker-in-Docker Requirement","text":"<p>Analysis of the codebase revealed:</p> <ul> <li>\u2705 The Dockerfile (<code>.devcontainer/Dockerfile</code>) does NOT install Docker CLI or Docker Engine</li> <li>\u2705 No Docker daemon is configured to run inside the container</li> <li>\u2705 No <code>docker.sock</code> mounting is configured in the devcontainer</li> <li>\u2705 CI/CD workflows (GitHub Actions) run Docker commands on the host runner, not inside the devcontainer</li> <li>\u2705 The base image (<code>mcr.microsoft.com/devcontainers/base</code>) does not include Docker by default</li> </ul> <p>Conclusion: There is no Docker-in-Docker (DinD) usage in this project.</p>"},{"location":"security/privileged-mode/#2-cicd-architecture","title":"2. CI/CD Architecture","text":"<p>The GitHub Actions workflows (<code>.github/workflows/publish.yml</code>, <code>.github/workflows/test-unified.yml</code>) build and test the UBI image using:</p> <ul> <li>Docker Buildx on the GitHub Actions runner (host)</li> <li>Standard Docker build commands</li> <li>No requirement for nested containerization</li> </ul> <p>The devcontainer is only used for local development in VS Code, not for building or testing the image.</p>"},{"location":"security/privileged-mode/#3-local-development-requirements","title":"3. Local Development Requirements","text":"<p>Investigated whether privileged mode is needed for:</p> <ul> <li>\u274c Docker-in-Docker: Not used</li> <li>\u274c Low-level host operations: Not required</li> <li>\u274c Special device access: Not needed</li> <li>\u274c Kernel module loading: Not required</li> <li>\u274c Network configuration: Standard networking is sufficient</li> <li>\u274c Mount operations: Standard bind mounts work without privileged mode</li> </ul> <p>Conclusion: No legitimate use case exists for privileged mode in this devcontainer.</p>"},{"location":"security/privileged-mode/#alternatives-evaluated","title":"Alternatives Evaluated","text":"<p>Even if Docker-in-Docker were required, safer alternatives exist:</p>"},{"location":"security/privileged-mode/#1-docker-socket-binding-recommended","title":"1. Docker Socket Binding (Recommended)","text":"<p>Instead of running Docker inside Docker, bind the host's Docker socket:</p> <pre><code>services:\n  development:\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n</code></pre> <p>Pros:</p> <ul> <li>No privileged mode required</li> <li>Uses host Docker daemon</li> <li>Better performance</li> <li>Simpler configuration</li> </ul> <p>Cons:</p> <ul> <li>Still requires careful permission management</li> <li>Grants significant access to host Docker daemon</li> </ul>"},{"location":"security/privileged-mode/#2-rootless-docker","title":"2. Rootless Docker","text":"<p>Run Docker daemon without root privileges:</p> <pre><code>services:\n  development:\n    environment:\n      - DOCKER_HOST=unix:///run/user/1000/docker.sock\n</code></pre> <p>Pros:</p> <ul> <li>Enhanced security</li> <li>No root privileges required</li> <li>Better isolation</li> </ul> <p>Cons:</p> <ul> <li>More complex setup</li> <li>Some features may be limited</li> </ul>"},{"location":"security/privileged-mode/#3-specific-capabilities","title":"3. Specific Capabilities","text":"<p>Grant only required Linux capabilities instead of full privileged mode:</p> <pre><code>services:\n  development:\n    cap_add:\n      - SYS_ADMIN\n      - NET_ADMIN\n</code></pre> <p>Pros:</p> <ul> <li>Principle of least privilege</li> <li>Better than full privileged mode</li> <li>Fine-grained control</li> </ul> <p>Cons:</p> <ul> <li>Requires careful analysis of needed capabilities</li> <li>Still presents some security risks</li> </ul>"},{"location":"security/privileged-mode/#decision-remove-privileged-mode","title":"Decision: Remove Privileged Mode","text":""},{"location":"security/privileged-mode/#rationale","title":"Rationale","text":"<ol> <li>No functional requirement: Docker-in-Docker is not used anywhere in the project</li> <li>Security improvement: Removing privileged mode significantly enhances container security</li> <li>Alignment with best practices: Follows principle of least privilege</li> <li>No impact on functionality: All existing workflows and local development scenarios work without it</li> <li>Better isolation: Maintains proper container isolation boundaries</li> </ol>"},{"location":"security/privileged-mode/#implementation","title":"Implementation","text":"<p>The change is minimal and surgical:</p> <p>File: <code>.devcontainer/docker-compose.yml</code></p> <pre><code>services:\n  development:\n    container_name: ${PROJECT_NAME:-profile}-development\n    hostname: ${PROJECT_NAME:-profile}-development\n    build:\n      context: ..\n      target: final\n      dockerfile: .devcontainer/Dockerfile\n    volumes:\n      - ..:/workspace:cached\n    command: sleep infinity\n-   privileged: true # required for docker-in-docker\n    user: vscode\n    &lt;&lt;: *settings\n</code></pre>"},{"location":"security/privileged-mode/#testing-validation","title":"Testing &amp; Validation","text":""},{"location":"security/privileged-mode/#tests-performed","title":"Tests Performed","text":"<ol> <li>\u2705 Devcontainer Rebuild: Container builds successfully without privileged mode</li> <li>\u2705 Environment Variables: All environment variables are correctly set</li> <li>\u2705 XDG Directories: All <code>/opt/universal/*</code> directories are accessible</li> <li>\u2705 File Permissions: User <code>vscode</code> has correct permissions</li> <li>\u2705 CI Workflows: All GitHub Actions workflows continue to operate normally</li> <li>\u2705 Local Development: VS Code devcontainer attaches and functions correctly</li> </ol>"},{"location":"security/privileged-mode/#validation-commands","title":"Validation Commands","text":"<pre><code># Build and start the devcontainer\ndocker-compose -f .devcontainer/docker-compose.yml up -d\n\n# Verify directory structure\ndocker exec profile-development ls -la /opt/universal\n\n# Verify environment variables\ndocker exec profile-development env | grep UNIVERSAL\n\n# Test vscode user permissions\ndocker exec -u vscode profile-development touch /opt/universal/cache/test\n</code></pre> <p>All tests passed without privileged mode.</p>"},{"location":"security/privileged-mode/#security-improvements","title":"Security Improvements","text":"<p>By removing <code>privileged: true</code>, the following security improvements are achieved:</p>"},{"location":"security/privileged-mode/#before-with-privileged-mode","title":"Before (with privileged mode)","text":"<ul> <li>\u274c Container could access all host devices</li> <li>\u274c Full kernel capability access</li> <li>\u274c No AppArmor/SELinux enforcement</li> <li>\u274c Potential container escape vectors</li> <li>\u274c Host compromise risk</li> </ul>"},{"location":"security/privileged-mode/#after-without-privileged-mode","title":"After (without privileged mode)","text":"<ul> <li>\u2705 Standard container isolation maintained</li> <li>\u2705 Limited kernel capabilities (only required ones)</li> <li>\u2705 AppArmor/SELinux profiles enforced</li> <li>\u2705 Reduced attack surface</li> <li>\u2705 Better compliance with security standards</li> <li>\u2705 Defense in depth maintained</li> </ul>"},{"location":"security/privileged-mode/#future-considerations","title":"Future Considerations","text":""},{"location":"security/privileged-mode/#if-docker-access-is-needed-in-the-future","title":"If Docker Access is Needed in the Future","text":"<p>Should the need arise to run Docker commands from within the devcontainer:</p> <ol> <li>First Choice: Bind mount Docker socket (see \"Alternatives Evaluated\" above)</li> <li>Second Choice: Install Docker CLI only and use host daemon via socket</li> <li>Last Resort: Use Docker-in-Docker feature with rootless mode</li> <li>Never: Do not re-enable <code>privileged: true</code> without thorough justification and security review</li> </ol>"},{"location":"security/privileged-mode/#documentation-requirements","title":"Documentation Requirements","text":"<p>Any future changes that require elevated privileges must:</p> <ul> <li>Be documented in this file with clear justification</li> <li>Include specific risks and mitigations</li> <li>Be reviewed by security team</li> <li>Consider principle of least privilege</li> <li>Evaluate all alternatives first</li> </ul>"},{"location":"security/privileged-mode/#references","title":"References","text":"<ul> <li>Docker Security Best Practices</li> <li>Principle of Least Privilege</li> <li>Docker Privileged Mode Documentation</li> <li>Devcontainer Security</li> <li>CIS Docker Benchmark</li> </ul>"},{"location":"security/privileged-mode/#conclusion","title":"Conclusion","text":"<p>The investigation conclusively determined that <code>privileged: true</code> was not necessary for any functionality in the UBI devcontainer. The flag has been safely removed, resulting in improved security posture while maintaining full functionality.</p> <p>Key Takeaways:</p> <ul> <li>Always question the necessity of privileged mode</li> <li>Investigate alternatives before granting elevated privileges</li> <li>Document security decisions thoroughly</li> <li>Test changes to validate no functionality is lost</li> <li>Follow principle of least privilege</li> </ul> <p>Last Updated: 2025-12-12 Reviewed By: Automated Security Audit Next Review: When Docker access requirements change</p>"}]}